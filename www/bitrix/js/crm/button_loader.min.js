(function(t){if(!t.BX){t.BX={}}else if(t.BX.SiteButton){return}t.BX.SiteButton={isShown:false,init:function(i){this.loadBxAnalytics();this.userParams=t.Bitrix24WidgetObject||{};this.config=i;this.handlers=this.userParams.handlers||{};this.eventHandlers=[];this.execEventHandler("init",[this]);if(!this.check()){return}this.loadedButtonCount=0;this.load();if(this.config.delay){var e=this;t.setTimeout(function(){e.show()},1e3*this.config.delay)}else{this.show()}},check:function(){if(!this.config.isActivated){return false}if(this.config.widgets.length==0){return false}if(!this.wm.checkPagesAll(this)){return false}return true},loadBxAnalytics:function(){if(typeof t._ba!="undefined"){return}var i=document.location.hostname;t._ba=t._ba||[];t._ba.push(["aid","ext:"+i]);t._ba.push(["host",i]);(function(){var t=document.createElement("script");t.type="text/javascript";t.async=true;t.src=(document.location.protocol=="https:"?"https://":"http://")+"bitrix.info/ba.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)})()},load:function(){this.execEventHandler("load",[this]);if(this.util.isIOS())this.addClass(document.documentElement,"bx-ios");if(this.util.isMobile())this.addClass(document.documentElement,"bx-touch");this.config.resources.forEach(function(t){switch(t.type){case"text/css":var i=document.createElement("STYLE");i.setAttribute("type","text/css");if(i.styleSheet){i.styleSheet.cssText=t.content}else{i.appendChild(document.createTextNode(t.content))}document.head.appendChild(i);break}},this);this.context=this.util.getNodeFromText(this.config.layout);if(!this.context){return}document.body.appendChild(this.context);this.container=this.context.querySelector("[data-b24-crm-button-cont]");this.shadow.init({caller:this,shadowNode:this.context.querySelector("[data-b24-crm-button-shadow]")});this.buttons.init({caller:this,container:this.container.querySelector("[data-b24-crm-button-block]"),blankButtonNode:this.context.querySelector("[data-b24-crm-button-widget-blank]"),openerButtonNode:this.context.querySelector("[data-b24-crm-button-block-button]")});this.wm.init({caller:this});this.hello.init({caller:this,context:this.container.querySelector("[data-b24-crm-hello-cont]")});this.wm.loadAll();this.execEventHandler("loaded",[this])},setPulse:function(t){t=t||false;var i=this.context.querySelector("[data-b24-crm-button-pulse]");if(!i){return}i.style.display=t?"":"none"},show:function(){this.removeClass(this.container,"b24-widget-button-disable");this.addClass(this.container,"b24-widget-button-visible");this.execEventHandler("show",[this]);this.isShown=true},hide:function(){this.addClass(this.container,"b24-widget-button-disable");this.execEventHandler("hide",[this])},addEventHandler:function(t,i){if(!t||!i){return}this.eventHandlers.push({eventName:t,handler:i})},execEventHandler:function(i,e){e=e||[];if(!i){return}this.eventHandlers.forEach(function(t){if(t.eventName==i){t.handler.apply(this,e)}},this);if(this.handlers[i]){this.handlers[i].apply(this,e)}var n="b24-sitebutton-"+i;if(t.BX.onCustomEvent){t.BX.onCustomEvent(document,n,e)}if(t.jQuery&&typeof t.$=="function"){var s=t.$(document);if(s&&s.trigger)s.trigger(n,e)}},onWidgetFormInit:function(t){this.execEventHandler("form-init",[t])},onWidgetClose:function(){this.buttons.hide();this.show()},addClass:function(t,i){if(t&&typeof t.className=="string"&&t.className.indexOf(i)===-1){t.className+=" "+i;t.className=t.className.replace("  "," ")}},removeClass:function(t,i){if(!t||!t.className){return}t.className=t.className.replace(i,"").replace("  "," ")},addEventListener:function(i,e,n){i=i||t;if(t.addEventListener){i.addEventListener(e,n,false)}else{i.attachEvent("on"+e,n)}},buttons:{isShown:false,isInit:false,wasOnceShown:false,wasOnceClick:false,blankButtonNode:null,list:[],animatedNodes:[],init:function(t){this.c=t.caller;this.container=t.container;this.blankButtonNode=t.blankButtonNode;this.openerButtonNode=t.openerButtonNode;this.openerClassName=this.c.config.location>3?"b24-widget-button-bottom":"b24-widget-button-top";var i=this;this.c.addEventListener(this.openerButtonNode,"click",function(t){if(i.list.length==1&&i.list[0].onclick&&!i.list[0].href){i.list[0].onclick.apply(this,[])}else{i.toggle()}});this.isInit=true;this.list.forEach(function(t){if(!t.node)this.insert(t)},this);this.animatedNodes=this.c.util.nodeListToArray(this.c.context.querySelectorAll("[data-b24-crm-button-icon]"));this.animate();this.c.addClass(this.c.context.querySelector("[data-b24-crm-button-pulse]"),"b24-widget-button-pulse-animate")},animate:function(){var t="b24-widget-button-icon-animation";var i=0;this.animatedNodes.forEach(function(e,n){if(this.c.util.hasClass(e,t))i=n;this.c.removeClass(e,t)},this);i++;i=i<this.animatedNodes.length?i:0;this.c.addClass(this.animatedNodes[i],t);if(this.animatedNodes.length>1){var e=this;setTimeout(function(){e.animate()},1500)}},toggle:function(){this.isShown?this.hide():this.show()},show:function(){if(this.c.util.isIOS())this.c.addClass(document.documentElement,"bx-ios-fix-frame-focus");{this.c.shadow.show()}this.isShown=true;this.wasOnceShown=true;this.c.addClass(this.c.container,this.openerClassName);this.c.addClass(this.container,"b24-widget-button-show");this.c.removeClass(this.container,"b24-widget-button-hide");this.c.hello.hide()},hide:function(){if(this.c.util.isIOS())this.c.removeClass(document.documentElement,"bx-ios-fix-frame-focus");this.isShown=false;this.c.addClass(this.container,"b24-widget-button-hide");this.c.removeClass(this.container,"b24-widget-button-show");this.c.removeClass(this.c.container,this.openerClassName);this.c.hello.hide();this.c.shadow.hide()},displayButton:function(t,i){this.list.forEach(function(e){if(e.id!=t)return;if(!e.node)return;e.node.style.display=i?"":"none"})},sortOut:function(){this.list.sort(function(t,i){return t.sort>i.sort?1:-1});this.list.forEach(function(t){if(!t.node)return;t.node.parentNode.appendChild(t.node)})},add:function(t){this.list.push(t);this.insert(t)},insert:function(i){if(!this.isInit){i.node=null;return null}var e=this.blankButtonNode.cloneNode(true);i.node=e;i.sort=i.sort||100;e.setAttribute("data-b24-crm-button-widget",i.id);e.setAttribute("data-b24-widget-sort",i.sort);if(i.classList&&i.classList.length>0){i.classList.forEach(function(t){this.c.addClass(e,t)},this)}if(i.title){var n=e.querySelector("[data-b24-crm-button-tooltip]");if(n){n.innerText=i.title}else{e.title=i.title}}if(i.icon){e.style["background-image"]="url("+i.icon+")"}else{if(i.iconColor){setTimeout(function(){var n="background-image";if(!t.getComputedStyle){return}var s=t.getComputedStyle(e,null).getPropertyValue(n);e.style[n]=(s||"").replace("FFF",i.iconColor.substring(1))},1e3)}if(i.bgColor){e.style["background-color"]=i.bgColor}}if(i.href){e.href=i.href;e.target=i.target?i.target:"_blank"}if(i.onclick){var s=this;this.c.addEventListener(e,"click",function(t){s.wasOnceClick=true;i.onclick.apply(s,[])})}this.container.appendChild(e);this.sortOut();return e}},shadow:{clickHandler:null,shadowNode:null,init:function(i){this.c=i.caller;this.shadowNode=i.shadowNode;var e=this;this.c.addEventListener(this.shadowNode,"click",function(t){e.onClick()});this.c.addEventListener(document,"keyup",function(i){i=i||t.e;if(i.keyCode==27){e.onClick()}})},onClick:function(){this.c.wm.hide();this.c.buttons.hide();if(!this.clickHandler){return}this.clickHandler.apply(this,[]);this.clickHandler=null},show:function(t){this.clickHandler=t;this.c.addClass(this.shadowNode,"b24-widget-button-show");this.c.removeClass(this.shadowNode,"b24-widget-button-hide");this.c.addClass(document.documentElement,"crm-widget-button-mobile")},hide:function(){this.c.addClass(this.shadowNode,"b24-widget-button-hide");this.c.removeClass(this.shadowNode,"b24-widget-button-show");this.c.removeClass(document.documentElement,"crm-widget-button-mobile")}},util:{getNodeFromText:function(t){var i=document.createElement("div");i.innerHTML=t;return i.children[0]},hasClass:function(t,i){var e=this.nodeListToArray(t.classList);var n=e.filter(function(t){return t==i});return n.length>0},nodeListToArray:function(t){var i=[];if(!t)return i;for(var e=0;e<t.length;e++){i.push(t.item(e))}return i},isIOS:function(){return/(iPad;)|(iPhone;)/i.test(navigator.userAgent)},isOpera:function(){return navigator.userAgent.toLowerCase().indexOf("opera")!=-1},isIE:function(){return document.attachEvent&&!this.isOpera()},isMobile:function(){return/(ipad|iphone|android|mobile|touch)/i.test(navigator.userAgent)},isArray:function(t){return t&&Object.prototype.toString.call(t)=="[object Array]"},isString:function(t){return t===""?true:t?typeof t=="string"||t instanceof String:false},evalGlobal:function(t){if(!t){return}var i=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.type="text/javascript";if(!this.isIE()){e.appendChild(document.createTextNode(t))}else{e.text=t}i.insertBefore(e,i.firstChild);i.removeChild(e)},isCurPageInList:function(i){var e=i.filter(function(i){var e=this.prepareUrl(i).split("*").map(function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}).join(".*");e="^"+e+"$";return new RegExp(e).test(this.prepareUrl(t.location.href))},this);return e.length>0},prepareUrl:function(t){if(t.substring(0,5)=="http:"){result=t.substring(7)}else if(t.substring(0,6)=="https:"){result=t.substring(8)}else{result=t}return result},getCookie:function(t){var i=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return i?decodeURIComponent(i[1]):undefined},setCookie:function(t,i,e){e=e||{};var n=e.expires;if(typeof n=="number"&&n){var s=new Date;s.setTime(s.getTime()+n*1e3);n=e.expires=s}if(n&&n.toUTCString){e.expires=n.toUTCString()}i=encodeURIComponent(i);var o=t+"="+i;for(var r in e){if(!e.hasOwnProperty(r)){continue}o+="; "+r;var c=e[r];if(c!==true){o+="="+c}}document.cookie=o}},wm:{showedWidget:null,init:function(t){this.c=t.caller},getList:function(){return this.c.config.widgets},getById:function(t){var i=this.c.config.widgets.filter(function(i){return t==i.id},this);return i.length>0?i[0]:null},hide:function(){if(!this.showedWidget){return}if(this.showedWidget.hide){this.c.util.evalGlobal(this.showedWidget.hide)}this.c.onWidgetClose();this.c.shadow.hide();this.showedWidget=null},show:function(t){if(!t.show||!this.c.util.isString(t.show)){return}this.showedWidget=t;this.c.shadow.show();this.c.util.evalGlobal(t.show);this.c.hide()},checkPagesAll:function(t){this.c=t;return this.c.config.widgets.some(this.checkPages,this)},checkPages:function(t){var i=this.c.util.isCurPageInList(t.pages.list);if(t.pages.mode=="EXCLUDE"){return!i}else{return i}},loadAll:function(){this.c.config.widgets.forEach(this.load,this)},load:function(t){t.isLoaded=false;t.buttonNode=this.c.buttons.add({id:t.id,href:this.getButtonUrl(t),sort:t.sort,classList:typeof t.classList!="undefined"?t.classList:null,title:typeof t.title!="undefined"?t.title:null,onclick:this.getButtonHandler(t),bgColor:t.useColors?this.c.config.bgColor:null,iconColor:t.useColors?this.c.config.iconColor:null});this.c.execEventHandler("load-widget-"+t.id,[t]);if(!this.checkPages(t)){this.c.buttons.displayButton(t.id,false);return}this.loadScript(t);t.isLoaded=true;this.loadedButtonCount++},getButtonHandler:function(t){var i=this;return function(){i.show(t)}},getButtonUrl:function(t){if(t.script||!t.show){return null}if(this.c.util.isString(t.show)||!t.show.url){return null}var i=null;if(this.c.util.isMobile()&&t.show.url.mobile)i=t.show.url.mobile;else if(!this.c.util.isMobile()&&t.show.url.desktop)i=t.show.url.desktop;else if(this.c.util.isString(t.show.url))i=t.show.url;return i},loadScript:function(t){if(!t.script){return}var i="";var e=false;var n=t.script.match(/<script\b[^>]*>(.*?)<\/script>/i);if(n&&n[1]){i=n[1];e=true}else{t.node=this.c.util.getNodeFromText(t.script);if(!t.node){return}e=false;if(typeof t.caption!="undefined"){var s=t.node.querySelector("[data-bx-crm-widget-caption]");if(s){s.innerText=t.caption}}}if(e){t.node=document.createElement("script");try{t.node.appendChild(document.createTextNode(i))}catch(o){t.node.text=i}document.head.appendChild(t.node)}else{document.body.insertBefore(t.node,document.body.firstChild)}}},hello:{isInit:false,wasOnceShown:false,condition:null,cookieName:"b24_sitebutton_hello",init:function(t){this.c=t.caller;if(this.isInit||this.c.util.getCookie(this.cookieName)=="y"){return}this.context=t.context;this.showClassName="b24-widget-button-popup-show";this.config=this.c.config.hello;this.delay=this.config.delay;this.buttonHideNode=this.context.querySelector("[data-b24-hello-btn-hide]");this.iconNode=this.context.querySelector("[data-b24-hello-icon]");this.nameNode=this.context.querySelector("[data-b24-hello-name]");this.textNode=this.context.querySelector("[data-b24-hello-text]");this.initHandlers();if(!this.config||!this.config.conditions||this.config.conditions.length==0){return}if(!this.condition){this.setConditions(this.config.conditions)}var i=this;this.c.addEventHandler("show",function(){if(!i.c.isShown){i.initCondition()}});this.isInit=true},setConditions:function(t){this.condition=this.findCondition(t);this.initCondition()},initCondition:function(){if(!this.condition){return}if(!this.isInit){return}if(this.condition.icon){this.iconNode.style["background-image"]="url("+this.condition.icon+")"}if(this.condition.name){this.nameNode.innerText=this.condition.name}if(this.condition.text){this.textNode.innerText=this.condition.text}if(this.condition.delay){this.delay=this.condition.delay}this.planShowing()},initHandlers:function(){var i=this;this.c.addEventListener(this.buttonHideNode,"click",function(e){i.hide();if(!e)e=t.event;if(e.stopPropagation){e.preventDefault();e.stopPropagation()}else{e.cancelBubble=true;e.returnValue=false}});this.c.addEventListener(this.context,"click",function(){i.showWidget()})},planShowing:function(){if(this.wasOnceShown||this.c.buttons.wasOnceClick){return}var t=this.delay||10;var i=this;setTimeout(function(){i.show()},t*1e3)},findCondition:function(t){if(!t){return}var i;i=t.filter(function(t){if(!t.pages||t.pages.MODE=="EXCLUDE"||t.pages.LIST.length==0){return false}return this.c.util.isCurPageInList(t.pages.LIST)},this);if(i.length>0){return i[0]}i=t.filter(function(t){if(!t.pages||t.pages.MODE=="INCLUDE"){return false}return!this.c.util.isCurPageInList(t.pages.LIST)},this);if(i.length>0){return i[0]}i=t.filter(function(t){return!t.pages},this);if(i.length>0){return i[0]}return null},showWidget:function(){this.hide();var t=null;if(this.condition&&this.condition.showWidgetId){t=this.c.wm.getById(this.condition.showWidgetId)}if(!t){t=this.c.wm.getById(this.config.showWidgetId)}if(!t){t=this.c.wm.getList()[0]}if(t){this.c.wm.show(t)}},show:function(){if(this.c.buttons.isShown){this.planShowing();return}this.wasOnceShown=true;this.c.addClass(this.context,this.showClassName)},hide:function(){this.c.removeClass(this.context,this.showClassName);this.c.util.setCookie(this.cookieName,"y",{expires:60*60*6})}}}})(window);
//# sourceMappingURL=button_loader.map.js
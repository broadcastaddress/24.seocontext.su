var VoxImplant=function(){};(function(t,i){var n="VI_WEBRTC_STATE_IDLE";var o="VI_WEBRTC_STATE_WS_CONNECTING";var s="VI_WEBRTC_STATE_WS_CONNECTED";var a="VI_WEBRTC_STATE_WS_CONNECTED";var r=t.VI_CALL_STATE_ALERTING="ALERTING";var l=t.VI_CALL_STATE_PROGRESSING="PROGRESSING";var c=t.VI_CALL_STATE_CONNECTED="CONNECTED";var f=t.VI_CALL_STATE_ENDED="ENDED";var d=6e3;var u=1e4;t.ZingayaAPI=function(t,h){var p=3e4;var C=[];var v=[];var m=false!==h;var g=function(){if(C.length){return C.pop()}return document.createElement("audio")};var y=function(e){b(e,null);C.push(e)};var S=function(){if(v.length){return v.pop()}return document.createElement("video")};var R=function(e){b(e,null);v.push(e)};var I=function(e){if(e){if(e.audioTracks)return e.audioTracks;if(e.getAudioTracks)return e.getAudioTracks()}return null};var T=function(e){if(e){if(e.videoTracks)return e.videoTracks;if(e.getVideoTracks)return e.getVideoTracks()}return null};var E=function(e,t){if(e){for(var i in e){e[i].enabled=t}}};var M=function(e,t,i){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!n){return Promise.reject(new Error("getUserMedia is not implemented in this browser"))}return new Promise(function(t,i){n.call(navigator,e,t,i)})};var w=t===true?true:false;var O={offerToReceiveAudio:true,offerToReceiveVideo:w};var A="wss";var P;var b;var N;var U;var _=null;var L=n;var F;var D;var V;var z;var x;var k;var H;var W=[];var X=false;var B=false;var j=true;var G=null;var q=null;var J=null;var K=1;var $=null;this.setVideoBandwidth=function(e){$=e};function Z(e){if($)e.sdp=e.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+$+"\r\n");return e}var Y=function(){F=typeof webkitRTCPeerConnection!="undefined";D=typeof mozRTCPeerConnection!="undefined";V=typeof MediaStreamTrack!="undefined"&&typeof MediaStreamTrack.getSources!="undefined"||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices;z=null;x=null;k=null;H=null;if(navigator.mediaDevices===i){navigator.mediaDevices={}}if(navigator.mediaDevices.getUserMedia===i){navigator.mediaDevices.getUserMedia=M}if(D){U=mozRTCIceCandidate;N=mozRTCPeerConnection;P=navigator.mozGetUserMedia.bind(navigator);b=function(e,t){if(t){e.mozSrcObject=t;e.load();e.play()}else{e.mozSrcObject=null;e.load()}}}if(F){N=webkitRTCPeerConnection;U=RTCIceCandidate;P=navigator.webkitGetUserMedia.bind(navigator);b=function(e,t){if(t){e.src=URL.createObjectURL(t);e.load();e.play()}else{e.pause()}}}else{if(typeof AdapterJS!="undefined"){N=window.RTCPeerConnection;U=window.RTCIceCandidate;P=navigator.getUserMedia.bind(navigator);b=window.attachMediaStream}}};var Q=false;var ee=null;var te={};var ie={};var ne=0;var oe=function(e){if(typeof this.writeLog=="function"){this.writeLog(e)}}.bind(this);var se=function(e){if(typeof this.writeTrace=="function"){this.writeTrace(e)}}.bind(this);var ae=function(e){if(L!=a){oe(e+" called while in state "+L);return false}else return true};var re;var le;var ce={year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"};this.writeLog=function(e){BXIM.webrtc.phoneLog("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",ce)+" "+e)};this.writeTrace=function(e){BXIM.webrtc.phoneLog("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",ce)+" "+e)};this.onConnectionEstablished=null;this.onConnectionFailed=null;this.onConnectionClosed=null;this.onLoginSuccessful=null;this.onLoginFailed=null;this.onIncomingCall=null;this.onCallRinging=null;this.onCallMediaStarted=null;this.onCallConnected=null;this.onCallEnded=null;this.onCallFailed=null;this.onSIPInfoReceived=null;this.onInstantMessageReceived=null;this.onTransferComplete=null;this.onTransferFailed=null;this.onNetStatsReceived=null;this.onRTCStatsCollected=null;this.onHandleRoster=null;this.onHandleRosterPresence=null;this.onHandleMessage=null;this.onHandleSelfPresence=null;this.onHandleChatState=null;this.onHandleMessageEvent=null;this.onHandleMessageRemoved=null;this.onHandleMessageModified=null;this.onHandleMessageModificationError=null;this.onHandleSubscription=null;this.onHandleRosterItem=null;this.onCallRemoteFunctionError=null;this.onIMError=null;this.onIMRosterError=null;this.onMUCError=null;this.onMUCRoomCreation=null;this.onMUCSubject=null;this.onMUCInfo=null;this.onMUCMessage=null;this.onMUCInvitation=null;this.onMUCInviteDecline=null;this.onMUCParticipantPresence=null;this.onMUCNewParticipant=null;this.onMUCParticipantExit=null;this.onMUCOperationResult=null;this.onMUCRooms=null;this.onMUCParticipants=null;this.onMUCBanList=null;this.onMUCHistory=null;this.onMUCMessageModified=null;this.onMUCMessageModificationError=null;this.onMUCMessageRemoved=null;this.onMUCChatState=null;this.onHistory=null;this.onUCConnected=null;this.onUCDisconnected=null;this.onVoicemail=null;this.onCheckComplete=null;this.onRemoteScreenCaptureStarted=null;this.onCallICETimeout=null;var fe=function(e,t){if(typeof this.onRTCStatsCollected=="function")this.onRTCStatsCollected(e,t)}.bind(this);var de=function(e,t){if(typeof this.onRemoteScreenCaptureStarted=="function")this.onRemoteScreenCaptureStarted(e,t)}.bind(this);var ue=function(e){if(typeof this.onCallICETimeout=="function")this.onCallICETimeout(e)}.bind(this);var he=function(e){var t={};for(var i in e){if(i.substring(0,2)=="X-"||i=="VI-CallData"){t[i]=e[i]}}return t};var pe=function(e){for(var t in e)if(t=="X-DirectCall")return e[t]=="true"?true:false;return false};var Ce=function(){ne=0;for(var e in te){ne++}};var ve=function(e){te[e.id()]=e;Ce()};var me=function(e){delete te[e];Ce()}.bind(this);Y();var ge=function(e){var t="";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t};var ye=function(){};this.muteMicrophone=function(e){X=e;if(ee){E(I(ee),!e)}};this.sendVideo=function(e){j=e;if(ee){E(T(ee),e)}};this.mutePlayback=function(e){B=e;for(var t in ie){ie[t].updateSpeakerMuteState()}};this.setPlaybackVolume=function(e){K=e;for(var t in ie){ie[t].setPlaybackVolume(e)}};this.getCalls=function(){var e=[];for(var t in te){e.push(t)}return e};this.setLocalVideoSink=function(e){re=e;if(ee){b(e,ee)}};this.setRemoteSinksContainerId=function(e){le=e};this.stopLocalStream=function(){if(ee){if(ee.active){ee.getTracks().forEach(function(e){e.stop()})}ee=null}}.bind(this);this.destroy=function(){this.disconnect();this.stopLocalStream()}.bind(this);this.disconnect=function(){if(_){Ee();_.onclose=null;_.close();Re()}};this.useAudioSource=function(e,t,i){if(V){z=e;this.requestMedia(w,t,i,true)}}.bind(this);this.useVideoSource=function(e,t,i){if(V){x=e;this.requestMedia(true,t,i,true)}}.bind(this);this.setConstraints=function(e,t,i,n){k=e;if(n===true)this.requestMedia(w,t,i,w)}.bind(this);this.setAudioConstraints=function(e,t,i,n){H=e;if(n===true)this.requestMedia(w,t,i,w)}.bind(this);this.requestMedia=function(e,t,i,n){var o,s=typeof navigator.mediaDevices!="undefined"&&typeof navigator.mediaDevices.enumerateDevices!="undefined"&&typeof MediaStreamTrack!="undefined"&&typeof MediaStreamTrack.getSources=="undefined"?"deviceId":"sourceId";if(z===null&&x===null){o={audio:true,video:e===true?true:false}}else{if(z!==null&&x!==null){if(s=="sourceId")o={audio:{mandatory:{sourceId:z}},video:{mandatory:{sourceId:x}}};else o={audio:{deviceId:{exact:z}},video:{deviceId:{exact:x}}}}else if(z!==null){if(s=="sourceId")o={audio:{mandatory:{sourceId:z}},video:e===true?true:false};else o={audio:{deviceId:{exact:z}},video:e===true?true:false}}else if(x!==null){if(s=="sourceId")o={audio:true,video:{mandatory:{sourceId:x}}};else o={audio:true,video:{deviceId:{exact:x}}}}}if(k!==null){if(F){if(k!==false)o.video={};else o.video=false}else o.video=k;if(typeof k.mandatory!="undefined")o.video.mandatory=k.mandatory;if(typeof k.optional!="undefined"){o.video.optional=k.optional;if(x!==null){if(s=="sourceId")o.video.mandatory.sourceId=x;else o.video.deviceId={exact:x}}}else{if(x!==null){if(s=="sourceId")o.video.mandatory.sourceId=x;else o.video.deviceId={exact:x}}}}if(H!==null){if(F){o.audio=H;if(z!==null){if(s=="sourceId"){if(typeof o.audio.mandatory=="undefined"){o.audio.mandatory={sourceId:z}}else{o.audio.mandatory.sourceId=z}}else{o.audio.deviceId={exact:z}}}}}if(ee&&n){this.stopLocalStream()}if(typeof o.video.mandatory!="undefined"){if(typeof o.video.mandatory.chromeMediaSourceId!="undefined")o.audio=false}navigator.mediaDevices.getUserMedia(o).then(function(e){this.gUM_success(e,t)}.bind(this)).catch(function(e){this.gUM_error(e,i)}.bind(this))}.bind(this);this.gUM_error=function(e,t){oe("Media access rejected: "+e.name);if(typeof t=="function"){t(e.name)}}.bind(this);this.gUM_success=function(e,t){var i;if(ee){if(ee.active){ee.getTracks().forEach(function(e){e.stop()})}for(i in ie){ie[i].setLocalStream(null)}}oe("Media access granted");ee=e;E(I(ee),!X);if(re){b(re,e)}for(i in ie){ie[i].setLocalStream(ee)}if(typeof t=="function"){t(ee)}for(i in Oe){Ae(i,Oe[i])}Oe={}}.bind(this);this.shareScreen=function(){if(typeof getScreenId!="undefined"){getScreenId(function(e,t,i){P(i,function(e){G=e;for(var t in ie){if(ie[t].isDirect())ie[t].addScreenSharing(G)}},function(e){oe(e)})})}else{oe("No screensharing extension is available")}};this.getRemoteParty=function(e){if(te[e]){return te[e].getRemoteParty()}return null};this.getCallState=function(e){if(te[e]){return te[e].getState()}return null};this.setCallActive=function(e,t){if(te[e]){if(t){this.unholdCall(e)}else{this.holdCall(e)}return te[e].setStreamsActive(t)}};this.isCallActive=function(e){if(te[e]){return te[e].streamsAreActive()}return false};this.connectTo=function(e,t,i,s,a){if(L==n){try{var r=D?"firefox":"chrome";if(typeof a!="undefined"&&a==false)r="voxmobile";_=new WebSocket(A+"://"+e+"/"+(s||"platform")+"?version=2&client="+r+"&referrer="+encodeURIComponent(t)+"&extra="+encodeURIComponent(i)+"&video="+(w===true?"true":"false")+"&q="+ge(12));L=o;_.onopen=Te;_.onclose=Ee;_.onerror=Ie;_.onmessage=Ue}catch(l){oe("WebSocket Error: "+l)}}else{oe("Error: called connectTo while in state "+L)}}.bind(this);this.startPreFlightCheck=function(e,t){if(ae("__startPreFlightCheck"))De("__startPreFlightCheck",[!!e,!!t])};this.login=function(e,t,i){if(ae("login"))De("login",[e,t,i?i:null])};this.loginStage2=function(e,t,i){if(ae("loginStage2"))De("loginStage2",[e,t,i?i:null])};this.loginGenerateOneTimeKey=function(e){if(ae("loginGenerateOneTimeKey"))De("loginGenerateOneTimeKey",[e])};this.loginUsingOneTimeKey=function(e,t,i){if(ae("loginUsingOneTimeKey"))De("loginUsingOneTimeKey",[e,t,i?i:null])};this.setOperatorACDStatus=function(e){if(ae("setOperatorACDStatus"))De("setOperatorACDStatus",[e])};this.callTo=function(e,t,i,n){var o=ge(36),s=!(typeof n!="undefined"&&n["wiredRemote"]===false),i=he(typeof i=="undefined"?{}:i);var a=new Le(o,l,e,"");a.setHeaders(i);ve(a);if(pe(i)){var r=Pe(o,true,s);r.outgoingCall()}else{De("createCall",[-1,e,t,o,null,null,i,n])}return o};this.transferCall=function(e,t){var i=[e,t];for(var n=0;n<i.length;n++){var o=te[i[n]];if(o){if(o.getState()!=c){oe("ERROR: trying to transfer call "+o.id()+" in state "+o.getState());return}}else{oe("ERROR: trying to transfer unknown call "+o.id());return}}De("transferCall",[e,t])};this.hangupCall=function(e,t){var i=te[e];if(i){if(i.getState()==r){De("rejectCall",[e,true,he(t)])}else{De("disconnectCall",[e,he(t)])}}else{oe("ERROR: trying to hangup unknown call "+e)}};this.rejectCall=function(e,t,i){var n=te[e];if(n){if(n.getState()==r){De("rejectCall",[e,true,he(i)])}else{oe("ERROR: trying to reject call "+e+" in state "+n.getState())}}else{oe("ERROR: trying to reject unknown call "+e)}};this.answerCall=function(e,t){var i=te[e];if(i){if(i.getState()==r){if(pe(i.getHeaders())){var n=i.getPeerConnection();n.createAnswer()}else{De("acceptCall",[e,he(t)])}}else{oe("ERROR: trying to answer call "+e+" in state "+i.getState())}}else{oe("ERROR: trying to answer unknown call "+e)}};this.sendDigit=function(e,t){var i=te[e];if(i){if(i.getState()==c){var n=i.getPeerConnection().getRTCPeerConnection();if(n.createDTMFSender){var o=n.createDTMFSender(ee.getAudioTracks()[0]);var s=500;var a=50;if(t==10)t="*";else if(t==11)t="#";if(o.canInsertDTMF){o.insertDTMF(t,s,a);return}}De("sendDTMF",[e,t])}else{oe("ERROR: trying to send digit to call "+e+" in state "+i.getState())}}else{oe("ERROR: trying to send digit to unknown call "+e)}};this.holdCall=function(e){var t=te[e];if(t){if(t.getState()==c){De("hold",[e])}else{oe("ERROR: trying to hold call "+e+" in state "+t.getState())}}else{oe("ERROR: trying to hold unknown call "+e)}};this.unholdCall=function(e){var t=te[e];if(t){if(t.getState()==c){De("unhold",[e])}else{oe("ERROR: trying to unhold call "+e+" in state "+t.getState())}}else{oe("ERROR: trying to unhold unknown call "+e)}};this.voicemailPromptFinished=function(e){var t=te[e];if(t){De("promptFinished",[e])}else{oe("ERROR: trying to record voicemail for unknown call "+e)}};this.sendSIPInfo=function(e,t,i,n,o){var s=te[e];if(s){if(s.getState()==c||s.getState()==r||s.getState()==l){De("sendSIPInfo",[e,t,i,n,he(o)])}else{oe("ERROR: trying to send SIP Info to call "+e+" in state "+s.getState())}}else{oe("ERROR: trying to send SIP Info to unknown call "+e)}};var Se=this.sendSIPInfo.bind(this);this.setDesiredVideoBandwidth=function(e){if(ae("setDesiredVideoBandwidth"))De("setDesiredVideoBandwidth",[e])};this.sendInstantMessage=function(e,t){this.sendSIPInfo(e,"application","zingaya-im",t,{})};this.sendTextMessage=function(e,t,i){if(ae("sendMessage"))De("sendMessage",[e,t,i])};this.editTextMessage=function(e,t,i){if(ae("editMessage"))De("editMessage",[e,t,i])};this.removeTextMessage=function(e,t){if(ae("removeMessage"))De("removeMessage",[e,t])};this.sendStatus=function(e,t){if(ae("sendStatus"))De("sendStatus",[e,t])};this.sendChatState=function(e,t){if(ae("sendChatState"))De("sendChatState",[e,t])};this.raiseMessageEvent=function(e,t,i){if(ae("raiseMessageEvent"))De("raiseMessageEvent",[e,t,i])};this.addRoster=function(e,t,i,n){if(ae("addRoster"))De("addRoster",[e,t,i,n])};this.addRosterItemGroup=function(e,t){if(ae("addRosterItemGroup"))De("addRosterItemGroup",[e,t])};this.delRosterItemGroup=function(e,t){if(ae("delRosterItemGroup"))De("delRosterItemGroup",[e,t])};this.moveRosterItemGroup=function(e,t,i){if(ae("moveRosterItemGroup"))De("moveRosterItemGroup",[e,t,i])};this.renameRosterItem=function(e,t){if(ae("renameRosterItem"))De("renameRosterItem",[e,t])};this.removeRoster=function(e){if(ae("removeRoster"))De("removeRoster",[e])};this.replySubscriptionRequest=function(e,t){if(ae("replySubscriptionRequest"))De("replySubscriptionRequest",[e,t])};this.joinMUC=function(e,t,i){if(ae("joinMUC"))De("joinMUC",[e,t,i])};this.leaveMUC=function(e,t){if(ae("leaveMUC"))De("leaveMUC",[e,t])};this.sendMUCMessage=function(e,t,i){if(ae("sendMUCMessage"))De("sendMUCMessage",[e,t,i])};this.editMUCMessage=function(e,t,i){if(ae("editMUCMessage"))De("editMUCMessage",[e,t,i])};this.removeMUCMessage=function(e,t){if(ae("removeMUCMessage"))De("removeMUCMessage",[e,t])};this.inviteMUC=function(e,t,i){if(ae("inviteMUC"))De("inviteMUC",[e,t,i])};this.declineMUCinvitation=function(e,t,i){if(ae("declineMUCinvitation"))De("declineMUCinvitation",[e,t,i])};this.ucReconnect=function(){if(ae("ucReconnect"))De("ucReconnect",[])};this.requestHistory=function(e,t,i,n){if(typeof i=="undefined")i=false;if(typeof n=="undefined")n=100;if(typeof t=="undefined")t="";if(ae("requestHistory"))De("requestHistory",[e,t,i,n])};this.requestMUCHistory=function(e,t,i,n){if(typeof i=="undefined")i=false;if(typeof n=="undefined")n=100;if(typeof t=="undefined")t="";if(ae("requestMUCHistory"))De("requestMUCHistory",[e,t,i,n])};this.setSubject=function(e,t){if(ae("setSubject"))De("setSubject",[e,t])};this.sendMUCChatState=function(e,t){if(ae("sendMUCChatState"))De("sendMUCChatState",[e,t])};this.kickMUCUser=function(e,t,i){if(ae("kickMUCUser"))De("kickMUCUser",[e,t,i])};this.banMUCUser=function(e,t,i){if(ae("banMUCUser"))De("banMUCUser",[e,t,i])};this.unbanMUCUser=function(e,t,i){if(ae("unbanMUCUser"))De("unbanMUCUser",[e,t,i])};this.getVideoElementId=function(e){var t=te[e];if(t){return t.getVideoElementId()}else{oe("ERROR: No such call "+e)}};this.getAudioElementId=function(e){var t=te[e];if(t){return t.getAudioElementId()}else{oe("ERROR: No such call "+e)}};this.getStats=function(e,t){var i=ie[e];if(i){i.getStats(t)}};this.getPeerConnection=function(e){return ie[e]};var Re=function(){for(var e in ie){ie[e].close()}ie={};te={};ne=0;if(q){clearTimeout(q)}if(J){clearTimeout(J)}};var Ie=function(e){_.onclose=null;oe("WS error: "+e);var t=L==a;var i=t?this.onConnectionClosed:this.onConnectionFailed;L=n;Re();if(typeof i=="function"){i(e)}}.bind(this);var Te=function(){L=s;oe("WS connected")}.bind(this);var Ee=function(){oe("WS closed");var e=L==a;var t=e?this.onConnectionClosed:this.onConnectionFailed;L=n;Re();if(typeof t=="function"){t("Connection closed")}}.bind(this);function Me(){if(J){clearTimeout(J);J=null;q=setTimeout(we,p)}}var we=function(){q=null;De("__ping",[]);J=setTimeout(function(){if(ne>0){Me();return}J=null;oe("WS closed");var e=L==a;var t=e?this.onConnectionClosed:this.onConnectionFailed;L=n;Re();if(typeof t=="function"){t("Connection closed")}}.bind(this),p)}.bind(this);var Oe={};var Ae=function(e,t){var i=Pe(e,false);i.start(t)};var Pe=function(e,t,i){BXIM.webrtc.phoneLog("createPeerConnection2 invoked");if(ie[e]){ie[e].close()}var n=new Fe(e,t,i);if(te[e]){n.setStreamsActive(te[e].streamsAreActive())}ie[e]=n;n.setLocalStream(ee);if(G){n.setScreenSharingStream(G)}var o=te[e];if(o){te[e].setPeerConnection(n);n.setCall(o)}return ie[e]};var be=null;var Ne;Ne={__createConnection:function(){if(L==s){L=a;if(typeof this.onConnectionEstablished=="function"){this.onConnectionEstablished(false)}q=setTimeout(we,p)}},__createPC:function(e,t){if(!m||ee||e=="__default"){Ae(e,t)}else{Oe[e]=t}},__destroyPC:function(e){if(ie[e]){ie[e].close();delete ie[e]}delete Oe[e]},__onPCStats:function(e,t){if(ie[e]){if(typeof this.onNetStatsReceived=="function"){this.onNetStatsReceived(t)}}},__pong:function(){Me()},__connectionSuccessful:function(){if(L==s){L=a;if(typeof this.onConnectionEstablished=="function"){this.onConnectionEstablished(true)}q=setTimeout(we,p)}},loginSuccessful:function(e,t){if(t)be=t.iceConfig;if(typeof this.onLoginSuccessful=="function"){this.onLoginSuccessful(e,t)}},loginFailed:function(e,t){if(typeof this.onLoginFailed=="function"){this.onLoginFailed({errorCode:e,oneTimeKey:t})}},handleConnectionConnected:function(e,t,i){var n=te[e];if(n){n.canStartSendingCandidates();if(n.getState()==l||n.getState()==r){n.setState(c);if(typeof i=="undefined"){}else{var o=n.getPeerConnection();o.onConnectionConnected(i)}if(typeof this.onCallConnected=="function"){this.onCallConnected(e,t)}}else{oe("WARNING: received handleConnectionConnected for call: "+e+" in invalid state: "+n.getState())}}else{oe("WARNING: received handleConnectionConnected for unknown call: "+e)}},stopRinging:function(e){var t=te[e];if(t){t.canStartSendingCandidates();if(typeof this.onCallMediaStarted=="function"){this.onCallMediaStarted(e)}}else{oe("WARNING: received stopRinging for unknown call: "+e)}},handleConnectionDisconnected:function(e,t,i){var n=te[e];if(n){n.setState(f);if(typeof this.onCallEnded=="function"){this.onCallEnded(e,t,i)}me(e)}else{oe("WARNING: received handleConnectionDisconnected for unknown call: "+e)}},handleConnectionFailed:function(e,t,i,n){var o=te[e];if(o){if(o.getState()==l){o.setState(f);if(typeof this.onCallFailed=="function"){this.onCallFailed(e,t,i,n)}me(e)}else{oe("WARNING: received handleConnectionFailed for call: "+e+" in invalid state: "+o.getState())}}else{oe("WARNING: received handleConnectionFailed for unknown call: "+e)}},handleRingOut:function(e){var t=te[e];if(t){t.canStartSendingCandidates();if(t.getState()==l){if(typeof this.onCallRinging=="function"){this.onCallRinging(e)}}else{oe("WARNING: received handleRingOut for call: "+e+" in invalid state: "+t.getState())}}else{oe("WARNING: received handleRingOut for unknown call: "+e)}},handleIncomingConnection:function(e,t,i,n,o){var s=new Le(e,r,t,i);s.setHeaders(n);ve(s);if(pe(n)){var a=Pe(e,true);a.onIncomingCall(o)}else{if(ie[e])s.setPeerConnection(ie[e])}if(typeof this.onIncomingCall=="function"){this.onIncomingCall(e,t,i,n)}else{this.rejectCall(e,486);oe("WARNING: Received incoming call while no handler was specified")}},handleSIPInfo:function(e,t,i,n,o){var s=te[e];if(s){if(s.getState()==c||s.getState()==l||s.getState()==r){if(t=="application"&&i=="zingaya-im"){if(typeof this.onInstantMessageReceived=="function"){this.onInstantMessageReceived(e,n)}}else if(t=="voximplant"&&i=="sdpfrag"){cands=JSON.parse(n);var a=s.getPeerConnection();for(var f in cands){a.addRemoteCandidate(cands[f][0],cands[f][1])}}else if(t=="vi"&&i=="sdpoffer"){var a=s.getPeerConnection();a.setRemoteSDP(true,n,o["X-ScreenStreamId"])}else if(t=="vi"&&i=="sdpanswer"){var a=s.getPeerConnection();a.setRemoteSDP(false,n,o["X-ScreenStreamId"])}else{if(typeof this.onSIPInfoReceived=="function"){this.onSIPInfoReceived(e,t+"/"+i,n,o)}}}else{oe("WARNING: received handleSIPInfo for call: "+e+" in invalid state: "+s.getState())}}else{oe("WARNING: received handleSIPInfo for unknown call: "+e)}},handleSipEvent:function(){},handleTransferStarted:function(){},handleTransferComplete:function(e){var t=te[e];if(t){if(this.onTransferComplete){this.onTransferComplete(e)}}else{oe("WARNING: received handleTransferComplete for unknown call: "+e)}},handleTransferFailed:function(e){var t=te[e];if(t){if(this.onTransferFailed){this.onTransferFailed(e)}}else{oe("WARNING: received handleTransferFailed for unknown call: "+e)}},handleRoster:function(e){se("handleRoster");if(typeof this.onHandleRoster=="function"){this.onHandleRoster(e)}},handleRosterItem:function(e,t,i,n,o){se("handleRosterItem id "+e+" resource "+t+" e "+i+" displayName "+n+" groups "+o);if(typeof this.onHandleRosterItem=="function"){this.onHandleRosterItem(e,t,i,n,o)}},handleRosterPresence:function(e,t,i,n){se("handleRosterPresence");if(typeof this.onHandleRosterPresence=="function"){this.onHandleRosterPresence(e,t,i,n)}},handleMessage:function(e,t,i,n,o){se("handleMessage with id "+n+" from "+e+" to "+o+": "+i);if(typeof this.onHandleMessage=="function"){this.onHandleMessage(e,t,i,n,o)}},handleSelfPresence:function(e,t,i,n){se("handleSelfPresence from "+e+": "+i);if(typeof this.onHandleSelfPresence=="function"){this.onHandleSelfPresence(e,t,i,n)}},handleChatState:function(e,t,i){se("handleChatState from "+e+": "+i);if(typeof this.onHandleChatState=="function"){this.onHandleChatState(e,t,i)}},handleMessageEvent:function(e,t,i,n){se("handleMessageEvent from "+e+": "+i);if(typeof this.onHandleMessageEvent=="function"){this.onHandleMessageEvent(e,t,i,n)}},handleMessageModified:function(e,t,i,n){se("handleMessageModified message id "+t+" by "+e+" in chat with "+n+" msg "+i);if(typeof this.onHandleMessageModified=="function"){this.onHandleMessageModified(e,t,i,n)}},handleMessageModifyError:function(e,t,i){se("handleMessageModifyError message id "+t+" by "+e+" with code "+i);if(typeof this.onHandleMessageModificationError=="function"){this.onHandleMessageModificationError(e,t,i)}},handleMessageRemoved:function(e,t,i){se("handleMessageRemoved message id "+t+" by "+e+" in chat with "+i);if(typeof this.onHandleMessageRemoved=="function"){this.onHandleMessageRemoved(e,t,i)}},handleSubscription:function(e,t,i,n){se("handleSubscription from "+e+": "+i);if(typeof this.onHandleSubscription=="function"){this.onHandleSubscription(e,t,i,n)}},onCallRemoteFunctionError:function(e,t,i,n){se("onCallRemoteFunctionError method "+e+" params "+t+" code "+i+" description "+n);if(typeof this.onCallRemoteFunctionError=="function"){this.onCallRemoteFunctionError(e,t,i,n)}},handleError:function(e,t,i){se("handleError type "+e+" code "+t+" description "+i);if(typeof this.onIMError=="function")this.onIMError(e,t,i)},handleUCConnected:function(e){se("handleUCConnected id "+e);if(typeof this.onUCConnected=="function")this.onUCConnected(e)},handleUCDisconnected:function(){se("handleUCDisconnected");if(typeof this.onUCDisconnected=="function")this.onUCDisconnected()},handleRosterError:function(e){se("handleRosterError code "+e);if(typeof this.onIMRosterError=="function")this.onIMRosterError(e)},handleMUCError:function(e,t,i,n){se("handleMUCError room "+e+" operation "+t+" code "+i+" text "+n);if(typeof this.onMUCError=="function")this.onMUCError(e,t,i,n)},handleMUCRoomCreation:function(e){se("handleMUCRoomCreation room "+e);if(typeof this.onMUCRoomCreation=="function")this.onMUCRoomCreation(e)},handleMUCSubject:function(e,t,i,n){se("handleMUCSubject room "+e+" id "+t+" resource "+i+" subject "+n);if(typeof this.onMUCSubject=="function")this.onMUCSubject(e,t,i,n)},handleMUCInfo:function(e,t,i,n){se("handleMUCInfo room "+e+" features "+t+" name "+i+" info "+n);if(typeof this.onMUCInfo=="function")this.onMUCInfo(e,t,i,n)},handleMUCMessage:function(e,t,i,n,o,s,a){se("handleMUCMessage room "+e+" message_id "+i+" private "+t+" timestamp "+n+" from "+o+" resource "+s+" msg "+a);if(typeof this.onMUCMessage=="function")this.onMUCMessage(e,i,t,n,o,s,a)},handleMUCInvitation:function(e,t,i,n,o,s){se("handleMUCInvitation room "+e+" from "+t+" reason "+i+" body "+n+" password "+o+" cont "+s);if(typeof this.onMUCInvitation=="function")this.onMUCInvitation(e,t,i,n,o,s)},handleMUCInviteDecline:function(e,t,i){se("handleMUCInviteDecline room "+e+" invitee "+t+" reason "+i);if(typeof this.onMUCInviteDecline=="function")this.onMUCInviteDecline(e,t,i)},handleMUCParticipantPresence:function(e,t,i,n){se("handleMUCParticipantPresence room "+e+" participant "+t+" presence "+i+" msg "+n);if(typeof this.onMUCParticipantPresence=="function")this.onMUCParticipantPresence(e,t,i,n)},handleMUCParticipantJoin:function(e,t,i){se("handleMUCParticipantJoin room "+e+" participant "+t+" displayName "+i);if(typeof this.onMUCNewParticipant=="function")this.onMUCNewParticipant(e,t,i)},handleMUCParticipantLeft:function(e,t){se("handleMUCParticipantLeft room "+e+" participant "+t);if(typeof this.onMUCParticipantExit=="function")this.onMUCParticipantExit(e,t)},handleMUCRooms:function(e){se("handleMUCRooms rooms "+e);if(typeof this.onMUCRooms=="function")this.onMUCRooms(e)},handleMUCParticipants:function(e,t){se("handleMUCParticipants room "+e+" list "+t);if(typeof this.onMUCParticipants=="function")this.onMUCParticipants(e,t)},handleMUCBanList:function(e,t){se("handleMUCBanList room "+e+" list "+t);if(typeof this.onMUCBanList=="function")this.onMUCBanList(e,t)},handleMUCOperationResult:function(e,t,i){se("handleMUCOperationResult room "+e+" operation "+t+" result "+i);if(typeof this.onMUCOperationResult=="function")this.onMUCOperationResult(e,t,i)},handleMUCHistory:function(e,t,i){se("handleMUCHistory room "+e+" mid "+t+" list "+i);if(typeof this.onMUCHistory=="function")this.onMUCHistory(e,t,i)},handleMUCMessageModified:function(e,t,i,n,o,s,a){se("handleMUCMessageModified room "+e+" priv "+t+" mid "+i+" timestamp "+n+" from "+o+" resource "+s+" msg "+a);if(typeof this.onMUCMessageModified=="function")this.onMUCMessageModified(e,t,i,n,o,s,a)},handleMUCMessageModifyError:function(e,t,i,n){se("handleMUCMessageModifyError room "+e+" priv "+t+" mid "+i+" with code "+n);if(typeof this.onMUCMessageModificationError=="function")this.onMUCMessageModificationError(e,t,i,n)},handleMUCMessageRemoved:function(e,t,i,n,o,s){se("handleMUCMessageRemoved room "+e+" priv "+t+" mid "+i+" timestamp "+n+" from "+o+" resource "+s);if(typeof this.onMUCMessageRemoved=="function")this.onMUCMessageRemoved(e,t,i,n,o,s)},handleMUCChatState:function(e,t,i,n){se("handleMUCChatState room "+e+" from "+t+" resource "+i+" state "+n);if(typeof this.onMUCChatState=="function")this.onMUCChatState(e,t,i,n)},handleHistory:function(e,t,i){se("handleHistory uri "+e+" mid "+t+" list "+i);if(typeof this.onHistory=="function")this.onHistory(e,t,i)},handlePreFlightCheckResult:function(e,t,i){if(this.onCheckComplete)this.onCheckComplete(e,t,i)},handleVoicemail:function(e){if(this.onVoicemail)this.onVoicemail(e)},__connectionFailed:function(){if(L!=n){this.disconnect()}}};var Ue=function(e){var t=JSON.parse(e.data);var i=t.name;var n=t.params;se("Called local function "+i+" with params "+JSON.stringify(n));if(typeof Ne[i]=="function"){Ne[i].apply(this,n)}else{oe("Unknown function called: "+i)}ye()}.bind(this);var _e=function(e,t){if(typeof mozRTCSessionDescription=="function")return new mozRTCSessionDescription({type:e,sdp:t});else return new RTCSessionDescription({type:e,sdp:t})};var Le=function(e,t,i,n,o){var s=e;var a=t;var r=i;var l=n;var c;var f;var d=o;var u=true;this.id=function(){return s};this.getRemoteParty=function(){return r};this.getState=function(){return a};this.setState=function(e){a=e};this.getDisplayName=function(){return l};this.wired=function(){return d};this.setPeerConnection=function(e){BXIM.webrtc.phoneLog("Set peer connection: "+e);c=e};this.getPeerConnection=function(){BXIM.webrtc.phoneLog("Get peer connection: "+c);return c};this.setHeaders=function(e){f=e};this.getHeaders=function(){return f};this.streamsAreActive=function(){return u};this.setStreamsActive=function(e){u=e;if(ie[s]){ie[s].setStreamsActive(e)}};this.getVideoElementId=function(){return c.getVideoElementId()};this.getAudioElementId=function(){return c.getAudioElementId()};this.canStartSendingCandidates=function(){c.canStartSendingCandidates()};this.notifyICETimeout=function(){ue(s)}};var Fe=function(t,i,n){var o=null;var s=false;var a=n===false?false:true;var r=null;if(i)r=be;var l=new N(r,{optional:[{DtlsSrtpKeyAgreement:"true"}]});if(D){l.removeStream=function(e){e.forEach(function(e){l.removeTrack(e)})}}var c=t;var f=i;this.isDirect=function(){return f};var h=function(e){oe("PC ["+c+"]: "+e)};var p=function(e){se("PC ["+c+"]: "+e)};var C=function(e){oe("PC ["+c+"] ERROR: "+e)};var v;this.setCall=function(e){v=e};this.getCall=function(){return v};var m=null;var M;var A;M=g();M.id="vi_audio_"+c;M.volume=K;document.body.appendChild(M);if(w){A=S();A.id="vi_video_"+c;A.width=400;A.height=300;A.volume=K;var P=le?document.getElementById(le):document.body;P.appendChild(A)}var _=null;var L=null;var V=false;var z=false;var x=null;var k=null;var H=null;var G=false;var q=false;var J=true;var $=null;var Y=function(){if(v){v.notifyICETimeout()}}.bind(this);this.getStats=function(e){var t;var i;var n;var o;if(!!H&&!!x){l.getStats(function(e){var t=e.result();for(var i in t){if(t[i].type=="ssrc"){if(t[i].local==t[i]||!t[i].remote){}if(t[i].remote==t[i]||!t[i].local){}}}})}};this.getRTCPeerConnection=function(){return l};this.getRemoteAudioStream=function(){return x};this.getRemoteVideoStream=function(){return k};this.getVideoElementId=function(){return A?A.id:null};this.getAudioElementId=function(){return M?M.id:null};this.setLocalStream=function(e){if(q)return;if(H){if(D)l.removeStream(W);else l.removeStream(H);H=null}if(e){H=e;var t=typeof e.getAudioTracks=="undefined"?e.audioTracks:e.getAudioTracks();var i=typeof e.getVideoTracks=="undefined"?e.videoTracks:e.getVideoTracks();H=e;if(D){H.getTracks().forEach(function(e){W.push(l.addTrack(e,H))})}else l.addStream(H);E(H.getAudioTracks(),!X);E(H.getVideoTracks(),j)}};var Q=function(e){if(e){$=e;l.addStream($)}};this.setScreenSharingStream=function(e){$=e};this.addScreenSharing=function(e){if(q)return;if($){l.removeStream($);$=null}Q(e)};this.onIncomingCall=function(e){if(q)return;_=_e("offer",e);l.setRemoteDescription(_,function(){},C)};this.onConnectionConnected=function(e){if(q)return;if(!f)return;_=_e("answer",e);l.setRemoteDescription(_,function(){o=setTimeout(Y,d)},C)};this.outgoingCall=function(){if(q)return;l.createOffer(function(e){Z(e);L=e;l.setLocalDescription(_e("offer",e.sdp),function(){ee()},C)},C,O)};var ee=function(){if(q)return;De("createCall",[-1,v.getRemoteParty(),false,t,null,null,v.getHeaders(),"",L.sdp])};this.createAnswer=function(){if(q)return;p("Calling createAnswer");

l.createAnswer(te,C)};var te=function(e){if(q){return}Z(e);V=e.sdp.indexOf("a=rtcp-mux")!=-1;l.setLocalDescription(e,function(){L=e;z=true;ie()},C)}.bind(this);var ie=function(){if(q){return}o=setTimeout(Y,d);h("Sending local answer");p("Local answer: "+L.sdp);if(f)De("acceptCall",[c,he(v.getHeaders()),L.sdp]);else De("__confirmPC",[c,L.sdp])};var ne=false;var ae=function(){if(ne)return;ne=true};var re=false;var ce=false;var ue=false;var pe=false;var Ce=false;var ve=null;var me=[];var ge=null;var ye=null;var Re=null;function Ie(){if(ve===null)ve=setTimeout(function(){ve=null;if(me.length>0){Se(c,"voximplant","sdpfrag",JSON.stringify(me),{})}me=[]},100)}function Te(e,t){me.push([t,e]);if(Ce)Ie()}this.canStartSendingCandidates=function(){Ce=true;Ie()};this.addRemoteCandidate=function(e,t){l.addIceCandidate(new U({candidate:t.substring(2),sdpMLineIndex:e}),function(){BXIM.webrtc.phoneLog("Added ice candidate")},function(e){p("error adding ice candidate "+e)})};var Ee=function(e){if(q)return;if(e.candidate){p("ICE candidate: "+e.candidate.candidate);var t=e.candidate.candidate;var i=t;if(i.indexOf("a=")==-1)i="a="+i;if(F&&L){L.sdp+=i;L.sdp+="\r\n"}if(!f)De("__addCandidate",[c,i,e.candidate.sdpMLineIndex]);else Te(i,e.candidate.sdpMLineIndex);if(!f){}}else{h("End of candidates.");ae()}};this.setRemoteSDP=function(e,t,i){if(typeof i=="string")ge=i;l.setRemoteDescription(_e(e?"offer":"answer",t),function(){if(e){l.createAnswer(function(e){Z(e);l.setLocalDescription(e,function(){Se(c,"vi","sdpanswer",e.sdp,null);s=false},function(e){})},function(e){h("Error: "+e)})}else{s=false}},function(e){h("Error: "+e)})};var Me=function(){if(q){h("Renegotiation requested on closed PeerConnection");return}if(L===null){h("Renegotiation needed, but no local SD, skipping");return}if(l.iceConnectionState!="connected"&&l.iceConnectionState!="completed"){h("Renegotiation requested while ice state is "+l.iceConnectionState+". Postponing");setTimeout(Me,100);return}if(s){h("Renegotiation in progress. Queueing");return}else{h("Renegotiation started")}s=true;if(f){l.createOffer(function(e){Z(e);h("New SDP: "+e.sdp);l.setLocalDescription(e,function(){var t={};if($){t["X-ScreenStreamId"]=$.id}Se(c,"vi","sdpoffer",e.sdp,t)},function(e){h("Error: "+e)})},function(e){h("ERROR: "+e)},O)}else{l.setRemoteDescription(_,function(){if(q){s=false;return}l.createAnswer(function(e){if(q){s=false;return}Z(e);L=e;l.setLocalDescription(L,function(){s=false;h("Renegotiation successful")},function(e){s=false;h("ERROR: "+e)})},function(e){s=false;h("ERROR: "+e)})},function(e){s=false;h("ERROR: "+e)})}};var we=function(t,i){if(!!navigator.mozGetUserMedia){t.getStats(null,function(e){BXIM.webrtc.phoneLog(e);var t=[];e.forEach(function(e){if(e.type=="inboundrtp"||e.type=="outboundrtp")t.push(e)});if(t.length>0)i(t)},function(t){h("ERROR: "+e)})}else{t.getStats(function(e){BXIM.webrtc.phoneLog(e);var t=[];e.result().forEach(function(e){var i={};e.names().forEach(function(t){i[t]=e.stat(t)});i.id=e.id;i.type=e.type;i.timestamp=e.timestamp;if(i.type=="ssrc")t.push(i)});i(t)})}};var Oe=function(e){var t=T(e.stream).length>0;var i=e.stream.id==ge;h("Remote stream added "+e.stream.id+" "+(t?"video":"audio"));if(i){if(Re==null){Re=S();Re.id="vi_ss_"+c;Re.width=400;Re.height=300;Re.volume=0;var n=le?document.getElementById(le):document.body;n.appendChild(Re)}ye=e.stream;b(Re,e.stream);de(c,Re.id)}else{if(t){k=e.stream}else{x=e.stream}if(t){if(A){if(a)b(A,e.stream)}}else{if(a)b(M,e.stream)}if(!t&&!m)m=setInterval(function(){we(l,function(e){fe(c,e)})},u);this.setStreamsActive(J)}};var Ae=function(e){};var Pe=function(e){if(l.signalingState=="stable"){if($!=null){var t=l.getLocalStreams();for(var i in t){if(t[i]==$){return}}Q($)}}};this.setPlaybackVolume=function(e){if(M){M.volume=e}if(A){A.volume=e}};this.streamsAreActive=function(){return J};this.setStreamsActive=function(e){J=e;E(I(x),e&&!B);E(I(k),e&&!B);E(T(k),e);De("__muteLocal",[c,!e])}.bind(this);this.updateMicrophoneMuteState=function(){};this.updateSpeakerMuteState=function(){if(x){E(I(x),J&&!B)}};this.activateStreams=function(){if(q){return}this.setStreamsActive(true)};this.deactivateStreams=function(){if(q){return}this.setStreamsActive(false)};l.onicecandidate=Ee.bind(this);l.onaddstream=Oe.bind(this);l.onnegotiationneeded=Me.bind(this);l.onremovestream=Ae.bind(this);l.onsignalingstatechange=Pe.bind(this);l.oniceconnectionstatechange=function(){if(l.iceConnectionState=="completed"||l.iceConnectionState=="connected"&&o){clearTimeout(o);o=null}}.bind(this);this.close=function(){q=true;if(m)clearInterval(m);m=null;l.close();if(M){if(typeof AdapterJS!="undefined"){document.getElementById(M.id).parentNode.removeChild(document.getElementById(M.id))}else M.parentNode.removeChild(M);y(M)}if(A){if(typeof AdapterJS!="undefined"){document.getElementById(A.id).parentNode.removeChild(document.getElementById(A.id))}else A.parentNode.removeChild(A);R(A)}if(Re){Re.parentNode.removeChild(Re);R(Re)}};this.start=function(e){if(q)return;_=_e("offer",e);l.setRemoteDescription(_,function(){l.createAnswer(function(e){Z(e);BXIM.webrtc.phoneLog("Local answer created: "+e.sdp);V=e.sdp.indexOf("a=rtcp-mux")!=-1;l.setLocalDescription(e,function(){L=e;z=true;ie()},C)},C)},C)}};var De=function(e,t){se("Called remote function "+e+" with params "+JSON.stringify(t));if(_){_.send(JSON.stringify({name:e,params:t}))}else{oe("ERROR: can't call remote function when not connected")}ye()}}})(VoxImplant);(function(e,t){e.Config={};e.FlashVideoSettings={};e.VideoSettings={};e.AudioSourceInfo={};e.DisconnectingFlags={};e.VideoSourceInfo={};e.AudioOutputInfo={};e.NetworkInfo={};e.SubscriptionRequestType={Subscribe:0,Unsubscribe:1};e.ChatStateType={Active:1,Composing:2,Paused:4,Inactive:8,Gone:16,Invalid:32};e.MessageEventType={Offline:1,Delivered:2,Displayed:4,Composing:8,Invalid:16,Cancel:32};e.RosterItemEvent={Added:0,Removed:1,Updated:2,Subscribed:3,Unsubscribed:4};e.UserStatuses={Online:0,Chat:1,Away:2,DND:3,XA:4,Offline:5};e.OperatorACDStatuses={Offline:"OFFLINE",Online:"ONLINE",Ready:"READY",InService:"IN_SERVICE",AfterService:"AFTER_SERVICE",Timeout:"TIMEOUT",DND:"DND"};e.IMErrorType={RemoteFunctionError:"RemoteFunctionError",Error:"Error",RosterError:"RosterError"};e.LoginOptions={};e.RosterItem={};e.ChatRoom={};e.ChatRoomInfo={};e.ChatRoomParticipant={};e.ChatRoomOperationType={Ban:13,Unban:12};e.ParticipantInfo={};e.IMHistoryMessage={}})(VoxImplant);(function(e,t){e.Events={SDKReady:"SDKReady",ConnectionEstablished:"ConnectionEstablished",ConnectionFailed:"ConnectionFailed",ConnectionClosed:"ConnectionClosed",AuthResult:"AuthResult",PlaybackFinished:"PlaybackFinished",MicAccessResult:"MicAccessResult",IncomingCall:"IncomingCall",SourcesInfoUpdated:"SourcesInfoUpdated",NetStatsReceived:"NetStatsReceived"};e.CallEvents={Connected:"Connected",Disconnected:"Disconnected",Failed:"Failed",ProgressToneStart:"ProgressToneStart",ProgressToneStop:"ProgressToneStop",MessageReceived:"MessageReceived",InfoReceived:"InfoReceived",TransferComplete:"TransferComplete",TransferFailed:"TransferFailed",RemoteScreenCaptureStarted:"RemoteScreenCaptureStarted",ICETimeout:"ICETimeout",RTCStatsReceived:"RTCStatsReceived"};e.IMEvents={RosterReceived:"RosterReceived",RosterItemChange:"RosterItemChange",RosterPresenceUpdate:"RosterPresenceUpdate",PresenceUpdate:"PresenceUpdate",MessageReceived:"MessageReceived",MessageModified:"MessageModified",MessageNotModified:"MessageNotModified",MessageRemoved:"MessageRemoved",ChatStateUpdate:"ChatStateUpdate",MessageStatus:"MessageStatus",SubscriptionRequest:"SubscriptionRequest",ChatHistoryReceived:"ChatHistoryReceived",ChatRoomCreated:"ChatRoomCreated",ChatRoomSubjectChange:"ChatRoomSubjectChange",ChatRoomInfo:"ChatRoomInfo",ChatRoomMessageReceived:"ChatRoomMessageReceived",ChatRoomInvitation:"ChatRoomInvitation",ChatRoomInviteDeclined:"ChatRoomInviteDeclined",ChatRoomPresenceUpdate:"ChatRoomPresenceUpdate",ChatRoomNewParticipant:"ChatRoomNewParticipant",ChatRoomParticipantExit:"ChatRoomParticipantExit",ChatRoomsDataReceived:"ChatRoomsDataReceived",ChatRoomParticipants:"ChatRoomParticipants",ChatRoomBanList:"ChatRoomBanList",ChatRoomHistoryReceived:"ChatRoomHistoryReceived",ChatRoomMessageModified:"ChatRoomMessageModified",ChatRoomMessageNotModified:"ChatRoomMessageNotModified",ChatRoomMessageRemoved:"ChatRoomMessageRemoved",ChatRoomStateUpdate:"ChatRoomStateUpdate",ChatRoomError:"ChatRoomError",ChatRoomOperation:"ChatRoomOperation",SystemError:"IMError",UCConnected:"UCConnected",UCDisconnected:"UCDisconnected"}})(VoxImplant);(function(e,t){e.Call=function(e,t,i,n,o,s){var a=o;var r=e;var l=t;var c=i;var f=n;var d=s;this.eventListeners={};this.call=function(e){if(typeof e=="undefined")return r;else r=e};this.__number=function(e){if(typeof e=="undefined")return l;else l=e};this.__displayName=function(){return c};this.__headers=function(){return f};this.RTC=function(){return a};this.zingayaAPI=function(){return d}};e.Call.prototype={id:function(){return this.call()},number:function(){return this.__number()},displayName:function(){return this.__displayName()},headers:function(){return this.__headers()},active:function(){return this.RTC()?this.zingayaAPI().isCallActive(this.call()):e.Utils.swfMovie("voximplantSWF").isCallActive(this.call())},state:function(){if(this.RTC())return this.zingayaAPI().getCallState(this.call());else{var t=e.Utils.swfMovie("voximplantSWF").getCallState(this.call()).toUpperCase();switch(t){case"CONNECTING":t=e.VI_CALL_STATE_ALERTING;break;case"CONNECTED_ON_HOLD":t=e.VI_CALL_STATE_CONNECTED;break;case"DISCONNECTED":case"FAILED":t=e.VI_CALL_STATE_ENDED;break}return t}},answer:function(t,i){if(typeof t!="undefined"){if(typeof i=="undefined")i={};i["VI-CallData"]=t}if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_ALERTING)throw new Error("NO_INCOMING_CALL");this.zingayaAPI().answerCall(this.call(),i)}else{i=JSON.stringify(i);BXIM.webrtc.phoneLog("Accepting call, id "+this.call());e.Utils.swfMovie("voximplantSWF").accept(this.call(),i)}},decline:function(t){if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_ALERTING)throw new Error("NO_INCOMING_CALL");this.zingayaAPI().rejectCall(this.call(),486,t)}else{t=e.Utils.stringifyExtraHeaders(t);e.Utils.swfMovie("voximplantSWF").reject(this.call(),t)}},reject:function(e){this.decline(e)},hangup:function(t){if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())==e.VI_CALL_STATE_CONNECTED||this.zingayaAPI().getCallState(this.call())==e.VI_CALL_STATE_PROGRESSING)this.zingayaAPI().hangupCall(this.call(),t);else throw new Error("WRONG_CALL_STATE")}else{t=e.Utils.stringifyExtraHeaders(t);e.Utils.swfMovie("voximplantSWF").disconnectCall(this.call(),t)}},sendTone:function(t){if(t=="*")t=10;else if(t=="#")t=11;else{t=parseInt(t);if(t<0||t>9)throw new Error("WRONG_TONE_INPUT")}if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED)throw new Error("CALL_NOT_CONNECTED");this.zingayaAPI().sendDigit(this.call(),t)}else{e.Utils.swfMovie("voximplantSWF").sendDTMF(t,this.call())}},mutePlayback:function(){if(this.RTC()){this.zingayaAPI().mutePlayback(true)}else{e.Utils.swfMovie("voximplantSWF").muteIncomingAudio(this.call())}},muteMicrophone:function(){if(this.RTC()){this.zingayaAPI().muteMicrophone(true)}else{e.Utils.swfMovie("voximplantSWF").muteOutgoingAudio(this.call())}},unmutePlayback:function(){if(this.RTC()){this.zingayaAPI().mutePlayback(false)}else{e.Utils.swfMovie("voximplantSWF").unmuteIncomingAudio(this.call())}},unmuteMicrophone:function(){if(this.RTC()){this.zingayaAPI().muteMicrophone(false)}else{e.Utils.swfMovie("voximplantSWF").unmuteOutgoingAudio(this.call())}},sendVideo:function(e){},showRemoteVideo:function(t){if(typeof t=="undefined")t=true;if(this.RTC()){document.getElementById(this.zingayaAPI().getVideoElementId(this.call())).style.display=t?"block":"none"}else{e.Utils.swfMovie("voximplantSWF").showRemoteVideo(this.call(),t)}},setRemoteVideoPosition:function(t,i){if(this.RTC()){throw new Error("Please use CSS to position '#voximplantcontainer' element")}else{e.Utils.swfMovie("voximplantSWF").setRemoteViewPosition(this.call(),t,i)}},setRemoteVideoSize:function(t,i){if(this.RTC()){throw new Error("Please use CSS to set size of '#voximplantcontainer' element")}else{e.Utils.swfMovie("voximplantSWF").setRemoteViewSize(this.call(),t,i)}},sendInfo:function(t,i,n){var o,s,a=t.indexOf("/");if(a==-1){o="application";s=t}else{o=t.substring(0,a);s=t.substring(a+1)}if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED)throw new Error("CALL_NOT_CONNECTED");this.zingayaAPI().sendSIPInfo(this.call(),o,s,i,n)}else{n=e.Utils.stringifyExtraHeaders(n);e.Utils.swfMovie("voximplantSWF").sendSIPInfo(this.call(),o,s,i,n)}},sendMessage:function(t){if(this.RTC()){if(this.zingayaAPI().getCallState(this.call())!=e.VI_CALL_STATE_CONNECTED)throw new Error("CALL_NOT_CONNECTED");this.zingayaAPI().sendInstantMessage(this.call(),t)}else{e.Utils.swfMovie("voximplantSWF").sendMessage(this.call(),t)}},setVideoSettings:function(t,i,n){if(this.RTC()){this.zingayaAPI().setConstraints(t,i,n,true)}else if(!this.useRTCOnly){if(Object.prototype.toString.call(t)=="[object Object]")t=JSON.stringify(t);e.Utils.swfMovie("voximplantSWF").setVideoSettings(t,this.call())}},getIncomingStreamInfo:function(){if(this.RTC()){}else if(!this.useRTCOnly){return JSON.parse(e.Utils.swfMovie("voximplantSWF").getIncomingStreamInfo(this.call()))}},getOutgoingStreamInfo:function(){if(this.RTC()){}else if(!this.useRTCOnly){return JSON.parse(e.Utils.swfMovie("voximplantSWF").getOutgoingStreamInfo(this.call()))}},getRemoteAudioStream:function(){return this.zingayaAPI().getPeerConnection(this.call()).getRemoteAudioStream()},getRemoteVideoStream:function(){return this.zingayaAPI().getPeerConnection(this.call()).getRemoteVideoStream()},setLocalStream:function(e){this.zingayaAPI().getPeerConnection(this.call()).setLocalStream(e)},getRTCPeerConnection:function(){return this.zingayaAPI().getPeerConnection(this.call()).getRTCPeerConnection()},getVideoElementId:function(){if(this.RTC()){return this.zingayaAPI().getVideoElementId(this.call())}},getAudioElementId:function(){if(this.RTC()){return this.zingayaAPI().getAudioElementId(this.call())}},useAudioOutput:function(e){if(this.RTC()){var t=this.zingayaAPI().getVideoElementId(this.call()),i=this.zingayaAPI().getAudioElementId(this.call());if(document.getElementById(i).currentTime>0){document.getElementById(i).setSinkId(e)}else if(document.getElementById(t).currentTime>0){document.getElementById(t).setSinkId(e)}}}};e.Call.prototype.addEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")this.eventListeners[e]=[];this.eventListeners[e].push(t)};e.Call.prototype.removeEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")return;for(var i=0;i<this.eventListeners[e].length;i++){if(this.eventListeners[e][i]==t){this.eventListeners[e].splice(i,1);break}}}})(VoxImplant);(function(e,t){e.Client=function(){this.config=null;this.calls=[];var i=e.Call;delete e.Call;var n=false;this.eventListeners={};this.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"};this.playingNow=false;this.serversList=[];var o=100;this.audioSourcesList=[];this.videoSourcesList=[];this.audioOutputsList=[];this.deviceEnumAPI=function(){if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)navigator.mediaDevices.enumerateDevices().then(this.gotSources);else if(typeof MediaStreamTrack!="undefined"&&typeof MediaStreamTrack.getSources!="undefined")MediaStreamTrack.getSources(this.gotSources)},this.gotSources=function(e){if(this.audioSourcesList.length!==0)this.audioSourcesList=[];if(this.videoSourcesList.length!==0)this.videoSourcesList=[];if(this.audioOutputsList.length!==0)this.audioOutputsList=[];var t=0,i=0,n=0;for(var o=0;o!=e.length;++o){var s=e[o];if(s.kind==="audio"||s.kind==="audioinput"){i++;this.audioSourcesList.push({id:s.id||s.deviceId,name:s.label||"Audio recording device "+i})}else if(s.kind==="video"||s.kind==="videoinput"){t++;this.videoSourcesList.push({id:s.id||s.deviceId,name:s.label||"Video recording device "+t})}else if(s.kind==="audiooutput"){n++;this.audioOutputsList.push({id:s.id||s.deviceId,name:s.label||"Audio playback device "+n})}}this.dispatchEvent({name:"SourcesInfoUpdated"})}.bind(this),this.__init=function(n){if(this.config!==null)throw"VoxImplant.Client has been already initialized";this.config=typeof n!=="undefined"?n:{};if(this.config.useFlashOnly===true)this.useFlashOnly=true;else this.useFlashOnly=false;if(this.config.useRTCOnly===true)this.useRTCOnly=true;else this.useRTCOnly=false;this.RTCsupported=false;if(this.config.micRequired!==false)this.micRequired=true;else this.micRequired=false;if(this.config.videoSupport!==true)this.videoSupport=false;else this.videoSupport=true;if(typeof this.config.videoConstraints!="undefined")this.videoConstraints=this.config.videoConstraints;else this.videoConstraints=null;if(typeof this.config.audioConstraints!="undefined")this.audioConstraints=this.config.audioConstraints;else this.audioConstraints=null;if(typeof this.config.swfContainer!="undefined")this.swfContainer=this.config.swfContainer;else this.swfContainer=null;if(typeof this.config.progressToneCountry!="undefined")this.progressToneCountry=this.config.progressToneCountry;else this.progressToneCountry="US";if(this.config.progressTone!==true)this.progressTone=false;else this.progressTone=true;if(this.config.showFlashSettings===true)this.showFlashSettings=true;else this.showFlashSettings=false;if(typeof this.config.serverIp!="undefined")this.serverIp=this.config.serverIp;if(typeof this.config.swfURL!="undefined")this.swfURL=this.config.swfURL;if(typeof this.config.showDebugInfo!="undefined")this.showDebugInfo=this.config.showDebugInfo;else this.showDebugInfo=true;if(typeof this.config.imXSSprotection!="undefined")this.imXSSprotection=this.config.imXSSprotection;else this.imXSSprotection=true;if(typeof this.config.imAutoReconnect!="undefined")this.imAutoReconnect=this.config.imAutoReconnect;else this.imAutoReconnect=true;if(typeof this.config.imReconnectInterval!="undefined")this.imReconnectInterval=this.config.imReconnectInterval>=2e3?this.config.imReconnectInterval:2e3;else this.imReconnectInterval=3e3;this.imReconnectTs=0;if(this.config.showWarnings!==false)this.showWarnings=true;else this.showWarnings=false;if(typeof this.config.videoContainerId==="string")this.videoContainerId=this.config.videoContainerId;if(this.config.connectivityCheck===false)this.connectivityCheck=false;else this.connectivityCheck=true;if(window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&window.location.protocol!="https:"){if(typeof console.error!="undefined"&&this.showWarnings)console.error("WARNING: getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details.")}if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"){if(typeof mozRTCPeerConnection!="undefined"){try{var o=new mozRTCPeerConnection({iceServers:[]});this.RTCsupported=true}catch(s){}}else this.RTCsupported=true}var a;if(this.RTCsupported&&!this.useFlashOnly){if(window.location.href.match(/^file\:\/{3}.*$/g)!=null){if(typeof console.error!="undefined"&&this.showWarnings)console.error("WebRTC requires application to be loaded from a web server")}this.zingayaAPI=new e.ZingayaAPI(this.videoSupport,this.micRequired);delete e.ZingayaAPI;this.zingayaAPI.setRemoteSinksContainerId(this.videoContainerId);this.zingayaAPI.onConnectionEstablished=function(){this.connectionState(true);this.dispatchEvent({name:"ConnectionEstablished"})}.bind(this);this.zingayaAPI.onConnectionFailed=function(e){this.connectionState(false);if(this.serversList.length>1&&typeof this.serverIp=="undefined"){this.serversList.splice(0,1);this.connectTo(this.serversList[0],true)}else this.dispatchEvent({name:"ConnectionFailed",message:e})}.bind(this);this.zingayaAPI.onConnectionClosed=function(){this.connectionState(false);this.__cleanup();this.dispatchEvent({name:"ConnectionClosed"});if(this.progressTone)this.stopProgressTone()}.bind(this);this.zingayaAPI.onLoginSuccessful=function(e,t){this.dispatchEvent({name:"AuthResult",result:true,displayName:e,options:t})}.bind(this);this.zingayaAPI.onLoginFailed=function(e){this.dispatchEvent({name:"AuthResult",result:false,code:e.errorCode,key:e.oneTimeKey})}.bind(this);this.zingayaAPI.onCallConnected=function(e,t){this.getCall(e).dispatchEvent({name:"Connected",call:this.getCall(e),headers:t});if(this.progressTone)this.stopProgressTone()}.bind(this);this.zingayaAPI.onCallEnded=function(e,t){this.getCall(e).dispatchEvent({name:"Disconnected",call:this.getCall(e),headers:t});this.removeCall(e);if(this.progressTone)this.stopProgressTone()}.bind(this);this.zingayaAPI.onCallFailed=function(e,t,i,n){this.getCall(e).dispatchEvent({name:"Failed",call:this.getCall(e),code:t,reason:i,headers:n});this.removeCall(e);if(this.progressTone)this.stopProgressTone()}.bind(this);this.zingayaAPI.onMediaAccessGranted=function(e){this.deviceEnumAPI();if(this.micRequired)this.zingayaAPI.connectTo(this.host,"platform",null,null,this.connectivityCheck);this.dispatchEvent({name:"MicAccessResult",result:true,stream:e})}.bind(this);this.zingayaAPI.onMediaAccessRejected=function(e){this.dispatchEvent({name:"MicAccessResult",result:false,reason:e})}.bind(this);this.zingayaAPI.onIncomingCall=function(e,t,n,o){var s=new i(e,t,n,o,true,this.zingayaAPI);if(this.calls.length>0)this.zingayaAPI.setCallActive(e,false);this.calls.push(s);this.dispatchEvent({name:"IncomingCall",call:s,headers:o})}.bind(this);this.zingayaAPI.onCallRinging=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStart",call:this.getCall(e)});if(this.progressTone)this.playProgressTone()}.bind(this);this.zingayaAPI.onCallMediaStarted=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStop",call:this.getCall(e)});if(this.progressTone)this.stopProgressTone()}.bind(this);this.zingayaAPI.onRemoteScreenCaptureStarted=function(e,t){this.getCall(e).dispatchEvent({name:"RemoteScreenCaptureStarted",call:this.getCall(e),videoElementId:t})}.bind(this);this.zingayaAPI.onInstantMessageReceived=function(e,t){this.getCall(e).dispatchEvent({name:"MessageReceived",call:this.getCall(e),text:t})}.bind(this);this.zingayaAPI.onSIPInfoReceived=function(e,t,i,n){this.getCall(e).dispatchEvent({name:"InfoReceived",call:this.getCall(e),mimeType:t,body:i,headers:n})}.bind(this);this.zingayaAPI.onTransferComplete=function(e){this.getCall(e).dispatchEvent({name:"TransferComplete",call:this.getCall(e)})}.bind(this);this.zingayaAPI.onTransferFailed=function(e){this.getCall(e).dispatchEvent({name:"TransferFailed",call:this.getCall(e)})}.bind(this);this.zingayaAPI.onNetStatsReceived=function(e){this.dispatchEvent({name:"NetStatsReceived",stats:e})}.bind(this);this.zingayaAPI.onRTCStatsCollected=function(e,t){if(this.getCall(e)!=null)this.getCall(e).dispatchEvent({name:"RTCStatsReceived",stats:t})}.bind(this);this.zingayaAPI.onHandleRoster=function(e){this.dispatchEvent({name:"RosterReceived",roster:e})}.bind(this);this.zingayaAPI.onHandleRosterItem=function(e,t,i,n,o){this.dispatchEvent({name:"RosterItemChange",id:e,resource:t,type:i,displayName:n,groups:o})}.bind(this);this.zingayaAPI.onHandleRosterPresence=function(e,t,i,n){this.dispatchEvent({name:"RosterPresenceUpdate",id:e,resource:t,presence:i,message:n})}.bind(this);this.zingayaAPI.onHandleMessage=function(t,i,n,o,s){if(this.imXSSprotection)n=e.Utils.filterXSS(n);this.dispatchEvent({name:"MessageReceived",id:t,resource:i,content:n,message_id:o,to:s})}.bind(this);this.zingayaAPI.onHandleSelfPresence=function(e,t,i,n){this.dispatchEvent({name:"PresenceUpdate",id:e,resource:t,presence:i,message:n})}.bind(this);this.zingayaAPI.onHandleChatState=function(e,t,i){this.dispatchEvent({name:"ChatStateUpdate",id:e,resource:t,state:i})}.bind(this);this.zingayaAPI.onHandleMessageEvent=function(e,t,i,n){this.dispatchEvent({name:"MessageStatus",id:e,resource:t,type:i,message_id:n})}.bind(this);this.zingayaAPI.onHandleMessageModified=function(t,i,n,o){if(this.imXSSprotection)n=e.Utils.filterXSS(n);this.dispatchEvent({name:"MessageModified",id:t,message_id:i,content:n,to:o})}.bind(this);this.zingayaAPI.onHandleMessageModificationError=function(e,t,i){this.dispatchEvent({name:"MessageNotModified",to:e,message_id:t,code:i})}.bind(this);this.zingayaAPI.onHandleMessageRemoved=function(e,t,i){this.dispatchEvent({name:"MessageRemoved",id:e,message_id:t,to:i})}.bind(this);this.zingayaAPI.onHandleSubscription=function(e,t,i,n){this.dispatchEvent({name:"SubscriptionRequest",id:e,resource:t,type:i,message:n})}.bind(this);this.zingayaAPI.onCallRemoteFunctionError=function(e,t,i,n){this.dispatchEvent({name:"IMError",errorType:"RemoteFunctionError",errorData:{method:e,params:t,code:i,description:n}})}.bind(this);this.zingayaAPI.onIMError=function(e,t,i){this.dispatchEvent({name:"IMError",errorType:"Error",errorData:{type:e,code:t,description:i}})}.bind(this);this.zingayaAPI.onUCConnected=function(e){if(this.imAutoReconnect===true)clearInterval(this.imReconnectTs);this.dispatchEvent({name:"UCConnected",id:e})}.bind(this);this.zingayaAPI.onUCDisconnected=function(){if(this.imAutoReconnect===true){clearInterval(this.imReconnectTs);this.imReconnectTs=setInterval(function(){this.zingayaAPI.ucReconnect()}.bind(this),this.imReconnectInterval)}this.dispatchEvent({name:"UCDisconnected"})}.bind(this);this.zingayaAPI.onIMRosterError=function(e){this.dispatchEvent({name:"IMError",errorType:"RosterError",errorData:{code:e}})}.bind(this);this.zingayaAPI.onMUCError=function(e,t,i,n){this.dispatchEvent({name:"ChatRoomError",room:e,operation:t,code:i,text:n})}.bind(this);this.zingayaAPI.onMUCRoomCreation=function(e){this.dispatchEvent({name:"ChatRoomCreated",room:e})}.bind(this);this.zingayaAPI.onMUCSubject=function(e,t,i,n){this.dispatchEvent({name:"ChatRoomSubjectChange",room:e,id:t,resource:i,subject:n})}.bind(this);this.zingayaAPI.onMUCInfo=function(e,t,i,n){this.dispatchEvent({name:"ChatRoomInfo",room:e,features:t,room_name:i,info:n})}.bind(this);this.zingayaAPI.onMUCMessage=function(t,i,n,o,s,a,r){if(this.imXSSprotection)r=e.Utils.filterXSS(r);this.dispatchEvent({name:"ChatRoomMessageReceived",room:t,message_id:i,private_message:n,timestamp:o,from:s,resource:a,content:r})}.bind(this);this.zingayaAPI.onMUCInvitation=function(e,t,i,n,o,s){this.dispatchEvent({name:"ChatRoomInvitation",room:e,from:t,reason:i,body:n,password:o,cont:s})}.bind(this);this.zingayaAPI.onMUCInviteDecline=function(e,t,i){this.dispatchEvent({name:"ChatRoomInviteDeclined",room:e,invitee:t,reason:i})}.bind(this);this.zingayaAPI.onMUCParticipantPresence=function(e,t,i,n){this.dispatchEvent({name:"ChatRoomPresenceUpdate",room:e,participant:t,presence:i,message:n})}.bind(this);this.zingayaAPI.onMUCNewParticipant=function(e,t,i){this.dispatchEvent({name:"ChatRoomNewParticipant",room:e,participant:t,displayName:i})}.bind(this);this.zingayaAPI.onMUCParticipantExit=function(e,t){this.dispatchEvent({name:"ChatRoomParticipantExit",room:e,participant:t})}.bind(this);this.zingayaAPI.onMUCOperationResult=function(e,t,i){this.dispatchEvent({name:"ChatRoomOperation",room:e,operation:t,result:i})}.bind(this);this.zingayaAPI.onMUCRooms=function(e){this.dispatchEvent({name:"ChatRoomsDataReceived",rooms:e})}.bind(this);this.zingayaAPI.onMUCParticipants=function(e,t){this.dispatchEvent({name:"ChatRoomParticipants",room:e,participants:t})}.bind(this);this.zingayaAPI.onMUCBanList=function(e,t){this.dispatchEvent({name:"ChatRoomBanList",room:e,participants:t})}.bind(this);this.zingayaAPI.onMUCHistory=function(t,i,n){if(this.imXSSprotection){n.forEach(function(t){t.body=e.Utils.filterXSS(t.body)})}this.dispatchEvent({name:"ChatRoomHistoryReceived",room:t,message_id:i,messages:n})}.bind(this);this.zingayaAPI.onMUCMessageModified=function(t,i,n,o,s,a,r){if(this.imXSSprotection)r=e.Utils.filterXSS(r);this.dispatchEvent({name:"ChatRoomMessageModified",room:t,private_message:i,message_id:n,timestamp:o,from:s,resource:a,content:r})}.bind(this);this.zingayaAPI.onMUCMessageModificationError=function(e,t,i,n){this.dispatchEvent({name:"ChatRoomMessageNotModified",room:e,private_message:t,message_id:i,code:n})}.bind(this);this.zingayaAPI.onMUCMessageRemoved=function(e,t,i,n,o,s){this.dispatchEvent({name:"ChatRoomMessageRemoved",room:e,private_message:t,message_id:i,timestamp:n,from:o,resource:s})}.bind(this);this.zingayaAPI.onMUCChatState=function(e,t,i,n){this.dispatchEvent({name:"ChatRoomStateUpdate",room:e,from:t,resource:i,state:n})}.bind(this);this.zingayaAPI.onHistory=function(t,i,n){if(this.imXSSprotection){n.forEach(function(t){t.body=e.Utils.filterXSS(t.body)})}this.dispatchEvent({name:"ChatHistoryReceived",id:t,message_id:i,messages:n})}.bind(this);this.zingayaAPI.onCallICETimeout=function(e){if(typeof this.getCall(e)!="undefined"&&this.getCall(e)!=null)this.getCall(e).dispatchEvent({name:"ICETimeout",call:this.getCall(e)});else BXIM.webrtc.phoneLog("ICETimeout on ended call "+e)}.bind(this);this.zingayaAPI.writeLog=function(e){if(typeof this.writeLog=="function")this.writeLog(e);else{var t={year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"};if(this.showDebugInfo)BXIM.webrtc.phoneLog("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",t)+" "+e)}}.bind(this);this.zingayaAPI.writeTrace=function(e){if(typeof this.writeTrace=="function")this.writeTrace(e);else{var t={year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"};if(this.showDebugInfo)BXIM.webrtc.phoneLog("VI WebRTC: "+(new Date).toLocaleTimeString("en-US",t)+" "+e)}}.bind(this);checkDOMReady=function(){if(typeof document!="undefined"){clearInterval(a);this.dispatchEvent({name:"SDKReady",version:e.version});this.deviceEnumAPI()}};a=setInterval(checkDOMReady.bind(this),100)}else if(!this.useRTCOnly){var r=function(){var e="undefined",i="object",n="Shockwave Flash",o="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",a="SWFObjectExprInst",l="onreadystatechange",c=window,f=document,d=navigator,u=false,h=[N],p=[],C=[],v=[],m,g,y,S,R=false,I=false,T,E,M=true,w=function(){var t=typeof f.getElementById!=e&&typeof f.getElementsByTagName!=e&&typeof f.createElement!=e,a=d.userAgent.toLowerCase(),r=d.platform.toLowerCase(),l=r?/win/.test(r):/win/.test(a),h=r?/mac/.test(r):/mac/.test(a),p=/webkit/.test(a)?parseFloat(a.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,C=!+"1",v=[0,0,0],m=null;if(typeof d.plugins!=e&&typeof d.plugins[n]==i){m=d.plugins[n].description;if(m&&!(typeof d.mimeTypes!=e&&d.mimeTypes[s]&&!d.mimeTypes[s].enabledPlugin)){u=true;C=false;m=m.replace(/^.*\s+(\S+\s+\S+$)/,"$1");v[0]=parseInt(m.replace(/^(.*)\..*$/,"$1"),10);v[1]=parseInt(m.replace(/^.*\.(.*)\s.*$/,"$1"),10);v[2]=/[a-zA-Z]/.test(m)?parseInt(m.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof c.ActiveXObject!=e){try{var g=new ActiveXObject(o);if(g){m=g.GetVariable("$version");if(m){C=true;m=m.split(" ")[1].split(",");v=[parseInt(m[0],10),parseInt(m[1],10),parseInt(m[2],10)]}}}catch(y){}}}return{w3:t,pv:v,wk:p,ie:C,win:l,mac:h}}(),O=function(){if(!w.w3){return}if(typeof f.readyState!=e&&f.readyState=="complete"||typeof f.readyState==e&&(f.getElementsByTagName("body")[0]||f.body)){A()}if(!R){if(typeof f.addEventListener!=e){f.addEventListener("DOMContentLoaded",A,false)}if(w.ie&&w.win){f.attachEvent(l,function(){if(f.readyState=="complete"){f.detachEvent(l,arguments.callee);A()}});if(c==top){(function(){if(R){return}try{f.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}A()})()}}if(w.wk){(function(){if(R){return}if(!/loaded|complete/.test(f.readyState)){setTimeout(arguments.callee,0);return}A()})();

}b(A)}}();function A(){if(R){return}try{var e=f.getElementsByTagName("body")[0].appendChild(B("span"));e.parentNode.removeChild(e)}catch(t){return}R=true;var i=h.length;for(var n=0;n<i;n++){h[n]()}}function P(e){if(R){e()}else{h[h.length]=e}}function b(t){if(typeof c.addEventListener!=e){c.addEventListener("load",t,false)}else{if(typeof f.addEventListener!=e){f.addEventListener("load",t,false)}else{if(typeof c.attachEvent!=e){j(c,"onload",t)}else{if(typeof c.onload=="function"){var i=c.onload;c.onload=function(){i();t()}}else{c.onload=t}}}}}function N(){if(u){U()}else{_()}}function U(){var t=f.getElementsByTagName("body")[0];var n=B(i);n.setAttribute("type",s);var o=t.appendChild(n);if(o){var a=0;(function(){if(typeof o.GetVariable!=e){var i=o.GetVariable("$version");if(i){i=i.split(" ")[1].split(",");w.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}}else{if(a<10){a++;setTimeout(arguments.callee,10);return}}t.removeChild(n);o=null;_()})()}else{_()}}function _(){var t=p.length;if(t>0){for(var i=0;i<t;i++){var n=p[i].id;var o=p[i].callbackFn;var s={success:false,id:n};if(w.pv[0]>0){var a=X(n);if(a){if(G(p[i].swfVersion)&&!(w.wk&&w.wk<312)){J(n,true);if(o){s.success=true;s.ref=L(n);o(s)}}else{if(p[i].expressInstall&&F()){var r={};r.data=p[i].expressInstall;r.width=a.getAttribute("width")||"0";r.height=a.getAttribute("height")||"0";if(a.getAttribute("class")){r.styleclass=a.getAttribute("class")}if(a.getAttribute("align")){r.align=a.getAttribute("align")}var l={};var c=a.getElementsByTagName("param");var f=c.length;for(var d=0;d<f;d++){if(c[d].getAttribute("name").toLowerCase()!="movie"){l[c[d].getAttribute("name")]=c[d].getAttribute("value")}}D(r,l,n,o)}else{V(a);if(o){o(s)}}}}}else{J(n,true);if(o){var u=L(n);if(u&&typeof u.SetVariable!=e){s.success=true;s.ref=u}o(s)}}}}}function L(t){var n=null;var o=X(t);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=e){n=o}else{var s=o.getElementsByTagName(i)[0];if(s){n=s}}}return n}function F(){return!I&&G("6.0.65")&&(w.win||w.mac)&&!(w.wk&&w.wk<312)}function D(t,i,n,o){I=true;y=o||null;S={success:false,id:n};var s=X(n);if(s){if(s.nodeName=="OBJECT"){m=z(s);g=null}else{m=s;g=n}t.id=a;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310){t.width="310"}if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137){t.height="137"}f.title=f.title.slice(0,47)+" - Flash Player Installation";var r=w.ie&&w.win?"ActiveX":"PlugIn",l="MMredirectURL="+c.location.toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+f.title;if(typeof i.flashvars!=e){i.flashvars+="&"+l}else{i.flashvars=l}if(w.ie&&w.win&&s.readyState!=4){var d=B("div");n+="SWFObjectNew";d.setAttribute("id",n);s.parentNode.insertBefore(d,s);s.style.display="none";(function(){if(s.readyState==4){s.parentNode.removeChild(s)}else{setTimeout(arguments.callee,10)}})()}x(t,i,n)}}function V(e){if(w.ie&&w.win&&e.readyState!=4){var t=B("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(z(e),t);e.style.display="none";(function(){if(e.readyState==4){e.parentNode.removeChild(e)}else{setTimeout(arguments.callee,10)}})()}else{e.parentNode.replaceChild(z(e),e)}}function z(e){var t=B("div");if(w.win&&w.ie){t.innerHTML=e.innerHTML}else{var n=e.getElementsByTagName(i)[0];if(n){var o=n.childNodes;if(o){var s=o.length;for(var a=0;a<s;a++){if(!(o[a].nodeType==1&&o[a].nodeName=="PARAM")&&!(o[a].nodeType==8)){t.appendChild(o[a].cloneNode(true))}}}}}return t}function x(t,n,o){var a,r=X(o);if(w.wk&&w.wk<312){return a}if(r){if(typeof t.id==e){t.id=o}if(w.ie&&w.win){var l="";for(var c in t){if(t[c]!=Object.prototype[c]){if(c.toLowerCase()=="data"){n.movie=t[c]}else{if(c.toLowerCase()=="styleclass"){l+=' class="'+t[c]+'"'}else{if(c.toLowerCase()!="classid"){l+=" "+c+'="'+t[c]+'"'}}}}}var f="";for(var d in n){if(n[d]!=Object.prototype[d]){f+='<param name="'+d+'" value="'+n[d]+'" />'}}r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+l+">"+f+"</object>";C[C.length]=t.id;a=X(t.id)}else{var u=B(i);u.setAttribute("type",s);for(var h in t){if(t[h]!=Object.prototype[h]){if(h.toLowerCase()=="styleclass"){u.setAttribute("class",t[h])}else{if(h.toLowerCase()!="classid"){u.setAttribute(h,t[h])}}}}for(var p in n){if(n[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"){k(u,p,n[p])}}r.parentNode.replaceChild(u,r);a=u}}return a}function k(e,t,i){var n=B("param");n.setAttribute("name",t);n.setAttribute("value",i);e.appendChild(n)}function H(e){var t=X(e);if(t&&t.nodeName=="OBJECT"){if(w.ie&&w.win){t.style.display="none";(function(){if(t.readyState==4){W(e)}else{setTimeout(arguments.callee,10)}})()}else{t.parentNode.removeChild(t)}}}function W(e){var t=X(e);if(t){for(var i in t){if(typeof t[i]=="function"){t[i]=null}}t.parentNode.removeChild(t)}}function X(e){var t=null;try{t=f.getElementById(e)}catch(i){}return t}function B(e){return f.createElement(e)}function j(e,t,i){e.attachEvent(t,i);v[v.length]=[e,t,i]}function G(e){var t=w.pv,i=e.split(".");i[0]=parseInt(i[0],10);i[1]=parseInt(i[1],10)||0;i[2]=parseInt(i[2],10)||0;return t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?true:false}function q(t,n,o,s){if(w.ie&&w.mac){return}var a=f.getElementsByTagName("head")[0];if(!a){return}var r=o&&typeof o=="string"?o:"screen";if(s){T=null;E=null}if(!T||E!=r){var l=B("style");l.setAttribute("type","text/css");l.setAttribute("media",r);T=a.appendChild(l);if(w.ie&&w.win&&typeof f.styleSheets!=e&&f.styleSheets.length>0){T=f.styleSheets[f.styleSheets.length-1]}E=r}if(w.ie&&w.win){if(T&&typeof T.addRule==i){T.addRule(t,n)}}else{if(T&&typeof f.createTextNode!=e){T.appendChild(f.createTextNode(t+" {"+n+"}"))}}}function J(e,t){if(!M){return}var i=t?"visible":"hidden";if(R&&X(e)){X(e).style.visibility=i}else{q("#"+e,"visibility:"+i)}}function K(t){var i=/[\\\"<>\.;]/;var n=i.exec(t)!=null;return n&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var $=function(){if(w.ie&&w.win){window.attachEvent("onunload",function(){var e=v.length;for(var t=0;t<e;t++){v[t][0].detachEvent(v[t][1],v[t][2])}var i=C.length;for(var n=0;n<i;n++){H(C[n])}for(var o in w){w[o]=null}w=null;for(var s in r){r[s]=null}r=null})}}();return{registerObject:function(e,t,i,n){if(w.w3&&e&&t){var o={};o.id=e;o.swfVersion=t;o.expressInstall=i;o.callbackFn=n;p[p.length]=o;J(e,false)}else{if(n){n({success:false,id:e})}}},getObjectById:function(e){if(w.w3){return L(e)}},embedSWF:function(t,n,o,s,a,r,l,c,f,d){var u={success:false,id:n};if(w.w3&&!(w.wk&&w.wk<312)&&t&&n&&o&&s&&a){J(n,false);P(function(){o+="";s+="";var h={};if(f&&typeof f===i){for(var p in f){h[p]=f[p]}}h.data=t;h.width=o;h.height=s;var C={};if(c&&typeof c===i){for(var v in c){C[v]=c[v]}}if(l&&typeof l===i){for(var m in l){if(typeof C.flashvars!=e){C.flashvars+="&"+m+"="+l[m]}else{C.flashvars=m+"="+l[m]}}}if(G(a)){var g=x(h,C,n);if(h.id==n){J(n,true)}u.success=true;u.ref=g}else{if(r&&F()){h.data=r;D(h,C,n,d);return}else{J(n,true)}}if(d){d(u)}})}else{if(d){d(u)}}},switchOffAutoHideShow:function(){M=false},ua:w,getFlashPlayerVersion:function(){return{major:w.pv[0],minor:w.pv[1],release:w.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(e,i,n){if(w.w3){return x(e,i,n)}else{return t}},showExpressInstall:function(e,t,i,n){if(w.w3&&F()){D(e,t,i,n)}},removeSWF:function(e){if(w.w3){H(e)}},createCSS:function(e,t,i,n){if(w.w3){q(e,t,i,n)}},addDomLoadEvent:P,addLoadEvent:b,getQueryParamValue:function(e){var t=f.location.search||f.location.hash;if(t){if(/\?/.test(t)){t=t.split("?")[1]}if(e==null){return K(t)}var i=t.split("&");for(var n=0;n<i.length;n++){if(i[n].substring(0,i[n].indexOf("="))==e){return K(i[n].substring(i[n].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(I){var e=X(a);if(e&&m){e.parentNode.replaceChild(m,e);if(g){J(g,true);if(w.ie&&w.win){m.style.display="block"}}if(y){y(S)}}I=false}}}}();createContainer=function(){if(typeof document!="undefined"){var e;clearInterval(a);if(this.swfContainer!==null){e=document.getElementById(this.swfContainer);if(e===null)throw new Error("NO_SWF_CONTAINER");if(e.offsetWidth<215)e.style.minWidth=e.style.width=215+"px";if(e.offsetHeight<138)e.style.minHeight=e.style.height=138+"px"}else{e=document.createElement("div");this.swfContainer=e.id="voximplantcontainer";e.style.minWidth=e.style.width=215+"px";e.style.minHeight=e.style.height=138+"px";if(document.body.firstChild)document.body.insertBefore(e,document.body.firstChild);else document.body.appendChild(e)}if(navigator.userAgent.indexOf("Safari")!=-1)e.style.minWidth=e.style.width=310+"px";var t=document.createElement("div");t.id="voximplantcontainerSWF";e.appendChild(t);var i={id:"voximplantSWF",name:"voximplantSWF"};var n=false;var o={allowScriptAccess:"always",wmode:"window",allowFullScreen:"true"};window.voxImplantFlashAPIReady=l.bind(this);var s=("https:"==document.location.protocol?"https://":"http://")+"cdn.voximplant.com/VoxImplant-3.1.swf?ver=200316";if(typeof this.swfURL!="undefined")s=this.swfURL;r.embedSWF(s,"voximplantcontainerSWF","100%","100%","11.3","http://cdn.voximplant.com/expressInstall.swf",n,o,i)}};if(!r.hasFlashPlayerVersion("11.3"))throw new Error("OLD_FLASH_VERSION");a=setInterval(createContainer.bind(this),100)}else{throw new Error("NO_WEBRTC_SUPPORT")}function l(){this.dispatchEvent({name:"SDKReady",version:e.version});if(navigator.userAgent.indexOf("Safari")!=-1){var t=document.getElementById(this.swfContainer);if(t!==null)t.style.minWidth=t.style.width=215+"px"}var i=JSON.parse(e.Utils.swfMovie("voximplantSWF").audioSources());var n=JSON.parse(e.Utils.swfMovie("voximplantSWF").videoSources());for(var o=0;o<i.length;o++)this.audioSourcesList.push({id:o,name:i[o]});for(o=0;o<n.length;o++)this.videoSourcesList.push({id:o,name:n[o]});this.dispatchEvent({name:"SourcesInfoUpdated"})}window.VILog=function(e){if(typeof this.writeLog=="function")this.writeLog(e);else{var t=new Date;var i="UTC";if(typeof t.getTimezoneOffset()!="undefined")i="UTC "+t.getTimezoneOffset/60;var n={year:"numeric",month:"numeric",day:"numeric",timeZone:i};if(this.showDebugInfo&&typeof console!="undefined")BXIM.webrtc.phoneLog("VI FLASH: "+t.toLocaleTimeString("en-US",n)+" "+e)}}.bind(this);window.VIConnectionEstablished=function(){this.connectionState(true);this.dispatchEvent({name:"ConnectionEstablished"})}.bind(this);window.VIConnectionFailed=function(){if(this.serversList.length>1&&typeof this.serverIp=="undefined"){this.serversList.splice(0,1);this.connectTo(this.serversList[0],true)}else{this.dispatchEvent({name:"ConnectionFailed"})}}.bind(this);window.VIConnectionClosed=function(){this.connectionState(false);this.__cleanup();this.dispatchEvent({name:"ConnectionClosed"});if(this.progressTone)this.stopProgressTone()}.bind(this);window.VIAuthFailed=function(e,t){this.dispatchEvent({name:"AuthResult",result:false,code:e,key:t})}.bind(this);window.VIAuthSuccessful=function(e,t){if(typeof t=="string")t=JSON.parse(t);this.dispatchEvent({name:"AuthResult",result:true,displayName:e,options:t})}.bind(this);window.VICallConnected=function(e,t){this.getCall(e).dispatchEvent({name:"Connected",call:this.getCall(e),headers:t!==null?JSON.parse(t):{}});if(this.progressTone)this.stopProgressTone()}.bind(this);window.VICallDisconnected=function(e,t){this.getCall(e).dispatchEvent({name:"Disconnected",call:this.getCall(e),headers:t!==null?JSON.parse(t):{}});this.removeCall(e);if(this.progressTone)this.stopProgressTone()}.bind(this);window.VICallFailed=function(e,t,i,n){this.getCall(e).dispatchEvent({name:"Failed",call:this.getCall(e),code:t,reason:i,headers:n!==null?JSON.parse(n):{}});this.removeCall(e);if(this.progressTone)this.stopProgressTone()}.bind(this);window.VIMicAccessResult=function(e){this.dispatchEvent({name:"MicAccessResult",result:e})}.bind(this);window.VIProgressToneStart=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStart",call:this.getCall(e)});if(this.progressTone)this.playProgressTone()}.bind(this);window.VIProgressToneStop=function(e){this.getCall(e).dispatchEvent({name:"ProgressToneStop",call:this.getCall(e)});if(this.progressTone)this.stopProgressTone()}.bind(this);window.VIIncomingCall=function(e,t,n,o){var s=new i(e,t,n,o!==null?JSON.parse(o):{},false);if(this.calls.length>0)this.zingayaAPI.setCallActive(e,false);this.calls.push(s);this.dispatchEvent({name:"IncomingCall",call:s,headers:o!==null?JSON.parse(o):{}})}.bind(this);window.VISIPInfoReceived=function(e,t,i,n,o){if(t=="application"&&i=="zingaya-im"){this.getCall(e).dispatchEvent({name:"MessageReceived",call:this.getCall(e),text:n})}else{if(o!==null)o=JSON.parse(o);this.getCall(e).dispatchEvent({name:"InfoReceived",call:this.getCall(e),mimeType:t+"/"+i,body:n,headers:o})}}.bind(this);window.VIToneScriptPlaybackStop=function(){this.dispatchEvent({name:"PlaybackFinished"})}.bind(this);window.VITransferComplete=function(e){this.getCall(e).dispatchEvent({name:"TransferComplete",call:this.getCall(e)})}.bind(this);window.VITransferFailed=function(e){this.getCall(e).dispatchEvent({name:"TransferFailed",call:this.getCall(e)})}.bind(this);window.VIPacketLossInfo=function(e){this.dispatchEvent({name:"NetStatsReceived",stats:{packetLoss:e}})}.bind(this);window.VIHandleRoster=function(e,t){this.dispatchEvent({name:"RosterReceived",id:e,roster:JSON.parse(t)})}.bind(this);window.VIHandleRosterPresence=function(e,t,i,n){this.dispatchEvent({name:"RosterPresenceUpdate",id:e,resource:t,presence:i,message:n})}.bind(this);window.VIHandleMessage=function(e,t,i,n){if(this.imXSSprotection){var o=document.createElement("div");o.appendChild(document.createTextNode(i));i=o.innerHTML}this.dispatchEvent({name:"MessageReceived",id:e,resource:t,content:i,message_id:n})}.bind(this);window.VIHandlePresence=function(e,t,i,n){this.dispatchEvent({name:"PresenceUpdate",id:e,resource:t,presence:i,message:n})}.bind(this);window.VIHandleChateState=function(e,t,i){this.dispatchEvent({name:"ChatStateUpdate",id:e,resource:t,state:i})}.bind(this);window.VIHandleMessageEvent=function(e,t,i,n){this.dispatchEvent({name:"MessageStatus",id:e,resource:t,type:i,message_id:n})}.bind(this);window.VIHandleRosterItem=function(e,t,i,n,o){this.dispatchEvent({name:"RosterItemChange",id:e,resource:t,type:i,displayName:o})}.bind(this);window.VIHandleSubscription=function(e,t,i,n){this.dispatchEvent({name:"SubscriptionRequest",id:e,resource:t,type:i,message:n})}.bind(this);window.VIHandleRemoteFunctionError=function(e,t,i,n){this.dispatchEvent({name:"IMError",errorType:"RemoteFunctionError",errorData:{method:e,params:JSON.parse(t),code:i,description:n}})}.bind(this);window.VIHandleIMError=function(e,t,i){this.dispatchEvent({name:"IMError",errorType:"Error",errorData:{type:e,code:t,description:i}})}.bind(this);window.VIHandleIMRosterError=function(e){this.dispatchEvent({name:"IMError",errorType:"RosterError",errorData:{code:e}})}.bind(this)},this.connectionState=function(e){if(typeof e=="undefined")return n;else n=e};this.getCall=function(e){for(var t=0;t<this.calls.length;t++){if(this.calls[t].call()==e)return this.calls[t]}return null};this.removeCall=function(e){var t=[];for(var i=0;i<this.calls.length;i++){if(this.calls[i].call()!=e)t.push(this.calls[i]);else delete this.calls[i]}this.calls=t};this.playProgressTone=function(){if(this.progressToneScript[this.progressToneCountry]!==null){if(!this.playingNow)this.playToneScript(this.progressToneScript[this.progressToneCountry]);this.playingNow=true}};this.stopProgressTone=function(){if(this.playingNow){this.stopPlayback();this.playingNow=false}};this.__call=function(t,n,o,s){if(typeof t=="object"){var n=typeof t["video"]=="undefined"?false:t["video"],o=t["customData"],s=t["extraHeaders"],a=typeof t["wiredLocal"]=="undefined"?true:t["wiredLocal"],r=typeof t["wiredRemote"]=="undefined"?true:t["wiredRemote"],t=t["number"]}if(typeof o!="undefined"){if(typeof s=="undefined")s={};s["VI-CallData"]=o}if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");var l,c;if(this.RTCsupported&&!this.useFlashOnly){l=this.zingayaAPI.callTo(t,n,s,{wiredRemote:r});c=new i(l,t,"",s,true,this.zingayaAPI);if(this.calls.length>0)this.zingayaAPI.setCallActive(l,false)}else if(!this.useRTCOnly){s=JSON.stringify(s);l=e.Utils.swfMovie("voximplantSWF").call(t,n,null,s);c=new i(l,t,"",s,false);if(this.calls.length>0)e.Utils.swfMovie("voximplantSWF").setCallActive(l,false)}this.calls.push(c);return c};this.__volume=function(e){if(typeof e=="undefined")return o;else o=e};this.__cleanup=function(){if(this.calls.length>0){var e=[],t;for(t in this.calls){e.push(this.calls[t].id());if(this.connectionState())this.calls[t].hangup()}for(t in e)this.removeCall(e[t])}}};e.Client.prototype={call:function(e,t,i,n){return this.__call(e,t,i,n)},config:function(){return this.config},connect:function(t){if(typeof t=="boolean")this.connectivityCheck=t;if(typeof this.serverIp!="undefined"){host=this.serverIp;this.connectTo(host)}else{balancerResult=function(e){var t=String(e).indexOf(";");if(t==-1){host=e}else{this.serversList=e.split(";");host=this.serversList[0]}this.connectTo(host)};e.Utils.getServers(balancerResult.bind(this),false,this)}},connectTo:function(t,i,n){if(typeof n=="boolean")this.connectivityCheck=n;if(this.connectionState()){throw new Error("ALREADY_CONNECTED_TO_VOXIMPLANT")}this.host=t;if(this.RTCsupported&&!this.useFlashOnly){if(!this.micRequired||i===true)this.zingayaAPI.connectTo(t,"platform",null,null,this.connectivityCheck);else{if(this.videoSupport)this.zingayaAPI.setConstraints(this.videoConstraints,null,null,false);if(this.audioConstraints)this.zingayaAPI.setAudioConstraints(this.audioConstraints,null,null,false);this.zingayaAPI.requestMedia(this.videoSupport,this.zingayaAPI.onMediaAccessGranted,this.zingayaAPI.onMediaAccessRejected)}}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").connect(t,i===true?false:this.micRequired,this.micRequired&&this.showFlashSettings)}},disconnect:function(){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");this.__cleanup();if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.destroy()}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").disconnect()}},init:function(e){this.__init(e)},setOperatorACDStatus:function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.setOperatorACDStatus(t)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setOperatorACDStatus(t)}},login:function(t,i,n){n=typeof n!=="undefined"?n:{};n=e.Utils.extend({},n);if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.login(t,i,n)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").login(t,i,JSON.stringify(n))}},loginWithCode:function(t,i,n){n=typeof n!=="undefined"?n:{};n=e.Utils.extend({serverPresenceControl:false},n);if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.loginStage2(t,i,n)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").loginStage2(t,i,JSON.stringify(n))}},requestOneTimeLoginKey:function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.loginGenerateOneTimeKey(t)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").requestOneTimeLoginKey(t)}},loginWithOneTimeKey:function(t,i,n){n=typeof n!=="undefined"?n:{};n=e.Utils.extend({serverPresenceControl:false},n);if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.loginUsingOneTimeKey(t,i,n)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").loginUsingOneTimeKey(t,i,JSON.stringify(n))}},connected:function(){return this.connectionState()},showLocalVideo:function(t){if(typeof t=="undefined")t=true;if(this.RTCsupported&&!this.useFlashOnly){if(t){if(document.getElementById("voximplantlocalvideo")===null){var i=document.createElement("video");i.id="voximplantlocalvideo";i.autoplay="autoplay";i.muted="true";if(document.body.firstChild)document.body.insertBefore(i,document.body.firstChild);else document.body.appendChild(i);this.zingayaAPI.setLocalVideoSink(i)}else document.getElementById("voximplantlocalvideo").style.display="block"}else{document.getElementById("voximplantlocalvideo").style.display="none"}}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").showLocalVideo(t)}},setLocalVideoPosition:function(t,i){if(this.RTCsupported&&!this.useFlashOnly){throw new Error("Please use CSS to position '#voximplantlocalvideo' element")}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setSelfViewPosition(t,i)}},setLocalVideoSize:function(t,i){if(this.RTCsupported&&!this.useFlashOnly){throw new Error("Please use CSS to set size of '#voximplantlocalvideo' element")}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setSelfViewSize(t,i)}},setVideoSettings:function(t,i,n,o){if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.setConstraints(t,function(e){if(document.getElementById("voximplantlocalvideo")!==null)this.zingayaAPI.setLocalVideoSink(document.getElementById("voximplantlocalvideo"));this.videoConstraints=t;if(typeof i=="function")i(e)}.bind(this),function(e){if(typeof n=="function")n(e)},true)}else if(!this.useRTCOnly){if(Object.prototype.toString.call(t)=="[object Object]")t=JSON.stringify(t);try{e.Utils.swfMovie("voximplantSWF").setVideoSettings(t)}catch(s){if(typeof n=="function")n()}if(typeof i=="function")i()}},setVideoBandwidth:function(e){if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.setVideoBandwidth(e);this.zingayaAPI.setDesiredVideoBandwidth(e)}},playToneScript:function(t,i){if(this.RTCsupported&&!this.useFlashOnly){e.Utils.playToneScript(t,i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").playToneScript(t,i)}},stopPlayback:function(){if(this.RTCsupported&&!this.useFlashOnly){if(e.Utils.stopPlayback())this.dispatchEvent({name:"PlaybackFinished"})}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").stopPlayback()}},volume:function(t){if(typeof t=="undefined"){return this.__volume()}else{if(t>100)t=100;if(t<0)t=0;if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.setPlaybackVolume(t/100)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").changeIncomingAudioVolume(t)}this.__volume(t)}},audioSources:function(){if(this.RTCsupported&&!this.useFlashOnly){if(!this.deviceEnumAPI)throw new Error("NOT_SUPPORTED: enumerateDevices")}return this.audioSourcesList},videoSources:function(){if(this.RTCsupported&&!this.useFlashOnly){if(!this.deviceEnumAPI)throw new Error("NOT_SUPPORTED: enumerateDevices")}return this.videoSourcesList},audioOutputs:function(){if(this.RTCsupported&&!this.useFlashOnly){if(!this.deviceEnumAPI)throw new Error("NOT_SUPPORTED: enumerateDevices")}return this.audioOutputsList},useAudioSource:function(t,i,n){if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.useAudioSource(t,function(e){if(typeof i=="function")i(e)},function(e){if(typeof n=="function")n(e)})}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setAudioSource(t)}},useVideoSource:function(t,i,n){if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.useVideoSource(t,function(e){if(document.getElementById("voximplantlocalvideo")!==null)this.zingayaAPI.setLocalVideoSink(document.getElementById("voximplantlocalvideo"));if(typeof i=="function")i(e)}.bind(this),function(e){if(typeof n=="function")n(e)})}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setVideoSource(t)}},attachRecordingDevice:function(e,t){if(this.RTCsupported&&!this.useFlashOnly&&!this.micRequired){this.zingayaAPI.requestMedia(this.videoSupport,function(t){if(typeof e=="function")e(t)},function(e){if(typeof t=="function")t(e)})}},detachRecordingDevice:function(){if(this.RTCsupported&&!this.useFlashOnly&&!this.micRequired){this.zingayaAPI.stopLocalStream()}},showFlashSettingsPanel:function(t){if(typeof t=="undefined")t="default";if(this.RTCsupported&&!this.useFlashOnly){}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").showFlashSettings(t)}},setCallActive:function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.setCallActive(t.call(),i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setCallActive(t.call(),i)}},sendVideo:function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(typeof t=="undefined")t=true;if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.sendVideo(t)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").sendVideo(t)}},isRTCsupported:function(){return this.RTCsupported},transferCall:function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.transferCall(t.call(),i.call())}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").transferCall(t.call(),i.call())}},setSwfColor:function(t){if(this.RTCsupported&&!this.useFlashOnly){}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setStageColor(t)}},setCodecPayload:function(t){if(this.RTCsupported&&!this.useFlashOnly){}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").setCodecPayload(t)}},startScreenSharing:function(){if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.shareScreen()}}};e.Client.prototype.addEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")this.eventListeners[e]=[];this.eventListeners[e].push(t)};e.Client.prototype.removeEventListener=function(e,t){if(typeof this.eventListeners[e]=="undefined")return;for(var i=0;i<this.eventListeners[e].length;i++){if(this.eventListeners[e][i]==t){this.eventListeners[e].splice(i,1);break}}};e.Client.prototype.dispatchEvent=e.Call.prototype.dispatchEvent=function(e){var t=e.name;if(typeof this.eventListeners[t]!="undefined"){for(var i=0;i<this.eventListeners[t].length;i++){if(typeof this.eventListeners[t][i]=="function"){this.eventListeners[t][i](e)}}}}})(VoxImplant);(function(e,t){e.Client.prototype.addRosterItem=function(t,i,n,o){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(typeof n=="undefined")n="";if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.addRoster(t,i,n,o)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").addRosterItem(t,i,n)}};e.Client.prototype.removeRosterItem=function(t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.removeRoster(t)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").removeRosterItem(t)}};e.Client.prototype.renameRosterItem=function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.renameRosterItem(t,i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").renameRosterItem(t,i)}};e.Client.prototype.addRosterItemGroup=function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.addRosterItemGroup(t,i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").addRosterItemGroup(t,i)}};e.Client.prototype.removeRosterItemGroup=function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.delRosterItemGroup(t,i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").delRosterItemGroup(t,i)}};e.Client.prototype.moveRosterItemGroup=function(t,i,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.moveRosterItemGroup(t,i,n)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").moveRosterItemGroup(t,i,n)}};e.Client.prototype.acceptSubscription=function(e){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.replySubscriptionRequest(e,true)}};e.Client.prototype.rejectSubscription=function(e){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.replySubscriptionRequest(e,false)}};e.Client.prototype.sendInstantMessage=function(t,i){var n=e.Utils.generateUUID();if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.sendTextMessage(t,i,n)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").sendInstantMessage(t,i,n)}return n};e.Client.prototype.editInstantMessage=function(e,t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.editTextMessage(e,t,i)}else if(!this.useRTCOnly){}};e.Client.prototype.removeInstantMessage=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.removeTextMessage(e,t)}else if(!this.useRTCOnly){}};e.Client.prototype.setChatState=function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.sendChatState(t,i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").sendChatState(t,i)}};e.Client.prototype.setMessageStatus=function(t,i,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(typeof n==="string")n=[n];else if(!Array.isArray(n)){throw new Error("message_id should be string or array")}if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.raiseMessageEvent(t,i,JSON.stringify(n))}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").raiseMessageEvent(t,i,JSON.stringify(n))}};e.Client.prototype.setPresenceStatus=function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.sendStatus(t,i)}else if(!this.useRTCOnly){e.Utils.swfMovie("voximplantSWF").sendStatus(t,i)}};e.Client.prototype.createChatRoom=function(t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");var n=e.Utils.generateUUID();if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.joinMUC(n,t,i)}else if(!this.useRTCOnly){}return n};e.Client.prototype.joinChatRoom=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.joinMUC(e,t)}else if(!this.useRTCOnly){}};e.Client.prototype.acceptChatRoomInvite=e.Client.prototype.joinChatRoom;e.Client.prototype.leaveChatRoom=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.leaveMUC(e,t)}else if(!this.useRTCOnly){}};e.Client.prototype.sendChatRoomMessage=function(t,i){var n=e.Utils.generateUUID();if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.sendMUCMessage(t,i,n)}else if(!this.useRTCOnly){}return n};e.Client.prototype.editChatRoomMessage=function(e,t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.editMUCMessage(e,t,i)}else if(!this.useRTCOnly){}};e.Client.prototype.removeChatRoomMessage=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.removeMUCMessage(e,t)}else if(!this.useRTCOnly){}};e.Client.prototype.inviteToChatRoom=function(e,t,i,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.inviteMUC(e,t,i,n)}else if(!this.useRTCOnly){}};e.Client.prototype.declineChatRoomInvite=function(e,t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");

if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.declineMUCinvitation(e,t,i)}else if(!this.useRTCOnly){}};e.Client.prototype.setChatRoomSubject=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.setSubject(e,t)}else if(!this.useRTCOnly){}};e.Client.prototype.removeChatRoomUser=function(e,t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.kickMUCUser(e,t,i)}else if(!this.useRTCOnly){}};e.Client.prototype.banChatRoomUser=function(e,t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.banMUCUser(e,t,i)}else if(!this.useRTCOnly){}};e.Client.prototype.unbanChatRoomUser=function(e,t,i){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.unbanMUCUser(e,t,i)}else if(!this.useRTCOnly){}};e.Client.prototype.getInstantMessagingHistory=function(e,t,i,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.requestHistory(e,t,i,n)}else if(!this.useRTCOnly){}};e.Client.prototype.getChatRoomHistory=function(e,t,i,n){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.requestMUCHistory(e,t,i,n)}else if(!this.useRTCOnly){}};e.Client.prototype.setChatRoomState=function(e,t){if(!this.connectionState())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(this.RTCsupported&&!this.useFlashOnly){this.zingayaAPI.sendMUCChatState(e,t)}else if(!this.useRTCOnly){}}})(VoxImplant);if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};n.prototype=this.prototype;o.prototype=new n;return o}}if(!window.JSON){throw new Error("Unsupported browser")}(function(e,i){e.Utils={source:null,extend:function(e){var t={};var i=function(e){for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i)){t[i]=e[i]}}};i(arguments[0]);for(var n=1;n<arguments.length;n++){var o=arguments[n];i(o)}return t},swfMovie:function(e){if(navigator.appName.indexOf("Microsoft")!=-1)return window[e];else return document[e]},stringifyExtraHeaders:function(e){if(Object.prototype.toString.call(e)=="[object Object]")e=JSON.stringify(e);else e=null;return e},cadScript:function(e){var t=e.split(";");return t.map(function(e){if(e.length===0){return}var t=e.match(/\([0-9\/\.,\*\+]*\)$/),i=e.substring(0,t.index),n=t.pop();if(t.length){throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`")}i=i==="*"?Infinity:parseFloat(i);if(isNaN(i)){throw new Error("cadence length should be of the form `%f`")}n=n.slice(1,n.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3){throw new Error}t=t.map(function(e,t){if(t===2){var i=e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t)){throw new Error}return t-1});return i}var n;if(e=="*"){n=Infinity}n=n?n:parseFloat(e,10);if(isNaN(n)){throw new Error}return n});return{on:t[0],off:t[1],frequencies:t[2]}}catch(i){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}});return{duration:i,sections:n}})},freqScript:function(e){var t=e.split(",");return t.map(function(e){try{var t=e.split("@"),i=parseInt(t.shift()),n=parseFloat(t.shift());if(t.length){throw Error()}return{frequency:i,decibels:n}}catch(o){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})},toneScript:function(t){var i=t.split(";"),n=e.Utils.freqScript(i.shift()),o=e.Utils.cadScript(i.join(";"));return{frequencies:n,cadences:o}},playToneScript:function(i,n){if(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined"){window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=new AudioContext,s=e.Utils.toneScript(i),a=[],r=0;processCadence=function(e){if(e.duration!=Infinity)r+=e.duration;else r+=20;for(var t=0;t<e.sections.length;t++){processSection(e.sections[t],e.duration)}};processSection=function(e,i){if(i!=Infinity)t=i;else t=i=20;if(e.off!==0&&e.off!=Infinity){while(t>0){addSound(e.frequencies,e.on);t-=e.on;addSilence(e.off);t-=e.off;t=parseInt(t*10)/10}}else{addSound(e.frequencies,i)}};addSilence=function(e){for(var t=0;t<o.sampleRate*e;t++)a.push(0)};addSound=function(e,t){for(var i=0;i<o.sampleRate*t;i++){var n=0;for(var r=0;r<e.length;r++){n+=Math.pow(10,s.frequencies[e[r]].decibels/20)*Math.sin((a.length+i)*(3.14159265359/o.sampleRate)*s.frequencies[e[r]].frequency);if(i<10)n*=i/10;if(i>o.sampleRate*t-10)n*=(o.sampleRate*t-i)/10}a.push(n)}};this.source=o.createBufferSource();for(var l=0;l<s.cadences.length;l++){if(s.cadences[l].duration==Infinity)this.source.loop=true;processCadence(s.cadences[l])}this.source.connect(o.destination);sndBuffer=o.createBuffer(1,r*o.sampleRate,o.sampleRate);bufferData=sndBuffer.getChannelData(0);for(var c=0;c<r*o.sampleRate;c++){bufferData[c]=a[c]}a=null;this.source.buffer=sndBuffer;if(n===true)this.source.loop=true;this.source.start(0)}},stopPlayback:function(){if(this.source!==null){this.source.stop(0);this.source=null;return true}return false},sendRequest:function(e,t,i,n){var o=false;var s=function(){var e=[function(){return new XDomainRequest},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var t=false;for(var i=0;i<e.length;i++){try{t=e[i]();if(i===0)o=true}catch(n){continue}break}return t};var a=s();if(!a)return;var r=n?"POST":"GET";if(!o){a.open(r,e,true);if(n)a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.onreadystatechange=function(){if(a.readyState!=4)return;if(a.status!=200&&a.status!=304){i(a);return}t(a)};if(a.readyState==4)return;a.send(n)}else{a.onerror=function(){i(a)};a.ontimeout=function(){i(a)};a.onload=function(){t(a)};a.open(r,e);a.timeout=5e3;a.send()}},getServers:function(t,i,n){var o="https:"==document.location.protocol?"https://":"http://";if(i===true)balancer_url=o+"balancer2.voximplant.com/getNearestHost";else balancer_url=o+"balancer.voximplant.com/getNearestHost";e.Utils.sendRequest(balancer_url,function(e){s(e.responseText)},function(e){s(null)});function s(o){if(o!==null)t(o);else if(i!==true)e.Utils.getServers(t,true,n);else n.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})}},generateUUID:function(){var t=e.Utils._gri,i=e.Utils._ha;return i(t(32),8)+"-"+i(t(16),4)+"-"+i(16384|t(12),4)+"-"+i(32768|t(14),4)+"-"+i(t(48),12)},_gri:function(e){if(e<0)return NaN;if(e<=30)return 0|Math.random()*(1<<e);if(e<=53)return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30);return NaN},_ha:function(e,t){var i=e.toString(16),n=t-i.length,o="0";for(;n>0;n>>>=1,o+=o){if(n&1){i=o+i}}return i},filterXSS:function(e){var t=document.createElement("div");t.appendChild(document.createTextNode(e));e=t.innerHTML;return e}};e.getInstance=function(){return e._clientInstance};e.version=e.Client.prototype.version="3.6.344";if(!e._clientInstance){e._clientInstance=new e.Client;delete e.Client}})(VoxImplant);
//# sourceMappingURL=voximplant.map.js
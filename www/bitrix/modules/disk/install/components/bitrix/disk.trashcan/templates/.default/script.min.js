BX.namespace("BX.Disk");BX.Disk.TrashCanClass=function(){var t=function(t){this.grid=t.grid;this.infoPanelContainer=t.infoPanelContainer;this.gridGroupActionButton=BX(t.gridGroupActionButton);this.gridShowTreeButton=BX(t.gridShowTreeButton);this.rootObject=t.rootObject||{};this.currentObjectIdInInfoPanel=null;this.actionGroupButton="move";this.checkboxes={};this.ajaxUrl="/bitrix/components/bitrix/disk.trashcan/ajax.php";this.grid.SetActionName("move");this.setGroupActionTargetObjectId(this.rootObject.id);this.setEvents()};t.prototype.setEvents=function(){BX.bind(BX("delete_button_"+this.grid.table_id),"click",BX.proxy(this.onClickDeleteGroup,this));BX.bind(this.gridGroupActionButton,"click",BX.proxy(this.onClickGridGroupActionButton,this));BX.bind(this.gridShowTreeButton,"click",BX.proxy(this.onClickGridShowTreeButton,this));BX.addCustomEvent("onEmptyTrashCan",BX.proxy(this.openConfirmEmpty,this));BX.addCustomEvent("onSelectRow",BX.proxy(this.onSelectRow,this));BX.addCustomEvent("onUnSelectRow",BX.proxy(this.onUnSelectRow,this))};t.prototype.setGroupActionTargetObjectId=function(t){var e=BX("grid_group_action_target_object");if(!e){this.grid.GetForm().appendChild(BX.create("input",{props:{id:"grid_group_action_target_object",name:"grid_group_action_target_object",type:"hidden",value:t}}))}else{e.value=t}};t.prototype.onClickGridGroupActionButton=function(t){function e(t){if(!t)return;return BX.findChild(t,{tagName:"span"})}BX.PopupMenu.show("folder-list-action-all-btn-menu",BX("folder-list-action-all-btn"),[{text:BX.message("DISK_TRASHCAN_TITLE_GRID_TOOLBAR_MOVE_BUTTON"),onclick:BX.delegate(function(t){this.actionGroupButton="move";this.grid.SetActionName("move");var n=BX.PopupMenu.getMenuById("folder-list-action-all-btn-menu");if(n){BX.adjust(e(n.bindElement),{text:BX.message("DISK_TRASHCAN_TITLE_GRID_TOOLBAR_MOVE_BUTTON")});n.popupWindow.close()}},this)},{text:BX.message("DISK_TRASHCAN_TITLE_GRID_TOOLBAR_COPY_BUTTON"),onclick:BX.delegate(function(t){this.actionGroupButton="copy";this.grid.SetActionName("copy");var n=BX.PopupMenu.getMenuById("folder-list-action-all-btn-menu");if(n){BX.adjust(e(n.bindElement),{text:BX.message("DISK_TRASHCAN_TITLE_GRID_TOOLBAR_COPY_BUTTON")});n.popupWindow.close()}},this)}],{autoHide:true})};t.prototype.onClickDeleteGroup=function(t){if(!this.grid.IsActionEnabled())return false;var e=document.getElementById("actallrows_"+this.grid.table_id);this.openConfirmDeleteGroup({attemptDeleteAll:e&&e.checked});BX.PreventDefault(t);return false};t.prototype.removeRow=function(t,e){this.grid.removeRow(t,e)};t.prototype.getRow=function(t){return this.grid.getRow(t)};t.prototype.getRowByCheckBox=function(t){return this.grid.getRowByCheckBox(t)};t.prototype.getCheckbox=function(t){return this.grid.getCheckbox(t)};t.prototype.openConfirmDelete=function(t){var e=t.object.name;var n=t.object.id;var o=t.object.isFolder;var i="";if(o){i=BX.message("DISK_TRASHCAN_TRASH_DELETE_DESTROY_FOLDER_CONFIRM")}else{i=BX.message("DISK_TRASHCAN_TRASH_DELETE_DESTROY_FILE_CONFIRM")}var s=[new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_DESTROY_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","destroy"),data:{objectId:n},onsuccess:BX.delegate(function(t){if(!t){return}if(t.status=="success"){this.removeRow(n,function(){BX.Disk.showModalWithStatusAction(t)});return}BX.Disk.showModalWithStatusAction(t)},this)});return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_CANCEL_DELETE_BUTTON"),events:{click:function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:i.replace("#NAME#",e),buttons:s})};t.prototype.openConfirmRestore=function(t){var e=t.object.name;var n=t.object.id;var o=t.object.isFolder;var i="";if(o){i=BX.message("DISK_TRASHCAN_TRASH_RESTORE_FOLDER_CONFIRM")}else{i=BX.message("DISK_TRASHCAN_TRASH_RESTORE_FILE_CONFIRM")}var s=[new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_RESTORE_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","restore"),data:{objectId:n},onsuccess:BX.delegate(function(t){if(!t){return}if(t.status=="success"){this.removeRow(n,function(){BX.Disk.showModalWithStatusAction(t)});return}BX.Disk.showModalWithStatusAction(t)},this)});return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_CANCEL_DELETE_BUTTON"),events:{click:function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:i.replace("#NAME#",e),buttons:s})};var e=false;var n=0;function o(){BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","destroyPortion"),data:{objectId:this.rootObject.id},onsuccess:BX.delegate(function(t){if(!t||t.status!="success")BX.Disk.showModalWithStatusAction(t);n-=t.countItems;if(n<0){n=0}var i=BX("bx-elements-to-destroy");BX.adjust(i,{text:n});if(n&&!e){BX.delegate(o,this)()}else{BX.reload()}},this)})}t.prototype.openConfirmEmpty=function(){var t=BX.message("DISK_TRASHCAN_TRASH_EMPTY_FOLDER_CONFIRM");var i=[new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_EMPTY_BUTTON"),id:"bx-disk-btn-start-trashcan",className:"popup-window-button-accept",events:{click:BX.delegate(function(t){BX.PreventDefault(t);BX.remove(BX("bx-disk-btn-start-trashcan"));BX.remove(BX("bx-disk-btn-cancel-trashcan"));BX.show(BX("bx-disk-btn-stop-empty-trashcan"),"inline-block");BX.Disk.ajax({method:"POST",dataType:"json",url:BX.Disk.addToLinkParam(this.ajaxUrl,"action","calculate"),data:{objectId:this.rootObject.id},onsuccess:BX.delegate(function(t){if(!t||t.status!="success")BX.Disk.showModalWithStatusAction(t);var e=BX("bx-empty-trashcan-container");BX.cleanNode(e);n=t.countItems;BX.adjust(e,{children:[BX.create("span",{text:BX.message("DISK_TRASHCAN_TRASH_COUNT_ELEMENTS")}),BX.create("span",{props:{id:"bx-elements-to-destroy"},text:t.countItems}),BX.create("span",{style:{margin:"0 auto",backgroundColor:"transparent",border:"none",position:"relative"},props:{id:"wd_progress",className:"bx-core-waitwindow"}})]});BX.delegate(o,this)()},this)})},this)}}),new BX.PopupWindowButton({id:"bx-disk-btn-cancel-trashcan",text:BX.message("DISK_TRASHCAN_TRASH_CANCEL_DELETE_BUTTON"),events:{click:function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);return false}}}),new BX.PopupWindowButton({id:"bx-disk-btn-stop-empty-trashcan",text:BX.message("DISK_TRASHCAN_TRASH_CANCEL_STOP_BUTTON"),events:{click:function(t){e=true;BX.PreventDefault(t);return false}}})];BX.Disk.modalWindow({modalId:"bx-empty-trashcan-modal",title:BX.message("DISK_TRASHCAN_TRASH_EMPTY_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},events:{onPopupShow:function(){BX.hide(BX("bx-disk-btn-stop-empty-trashcan"))}},content:[BX.create("div",{props:{id:"bx-empty-trashcan-container"},text:t})],buttons:i})};t.prototype.openConfirmDeleteGroup=function(t){var e=BX.message("DISK_TRASHCAN_TRASH_DELETE_GROUP_CONFIRM");var n=[new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_DESTROY_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);this.grid.ActionDelete();return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_CANCEL_DELETE_BUTTON"),events:{click:function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:e,buttons:n})};t.prototype.openConfirmRestoreGroup=function(t){var e=BX.message("DISK_TRASHCAN_TRASH_RESTORE_GROUP_CONFIRM");var n=[new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_RESTORE_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);this.grid.SetActionName("restore");this.actionGroupButton="restore";this.grid.SetActionName("restore");BX.submit(this.grid.GetForm());return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_TRASHCAN_TRASH_CANCEL_DELETE_BUTTON"),events:{click:function(t){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(t);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_TRASHCAN_TRASH_RESTORE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:e,buttons:n})};t.prototype.getFirstSelectedCheckbox=function(){var t;for(t in this.checkboxes){if(this.checkboxes.hasOwnProperty(t)&&typeof t!=="function"&&this.checkboxes[t]==true){break}}return this.getCheckbox(t)};t.prototype.addCheckbox=function(t){var e=t.value;if(!this.checkboxes[e]){this.checkboxes[e]=true}};t.prototype.deleteCheckbox=function(t){var e=t.value;if(this.checkboxes[e]){this.checkboxes[e]=false}};t.prototype.showInfoPanelManyObject=function(t){var e="bx-file-icon-container-small bx-disk-file-icon";var n=[];n.push(BX.create("a",{text:BX.message("DISK_TRASHCAN_TITLE_SIDEBAR_MANY_RESTORE_BUTTON"),style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"},events:{click:BX.proxy(this.openConfirmRestoreGroup,this)}}));n.push(BX.create("SPAN",{html:"&nbsp;"}));n.push(BX.create("a",{text:BX.message("DISK_TRASHCAN_TITLE_SIDEBAR_MANY_DELETE_BUTTON"),style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"},events:{click:BX.delegate(function(t){BX.fireEvent(BX("delete_button_"+this.grid.table_id),"click")},this)}}));this.showInfoPanel({buttons:n,isFolder:false,icon:{className:e},title:{text:BX.Disk.getNumericCase(t.length,BX.message("DISK_TRASHCAN_SELECTED_OBJECT_1"),BX.message("DISK_TRASHCAN_SELECTED_OBJECT_21"),BX.message("DISK_TRASHCAN_SELECTED_OBJECT_2_4"),BX.message("DISK_TRASHCAN_SELECTED_OBJECT_5_20")).replace("#COUNT#",t.length)}})};t.prototype.showInfoPanelSingleObject=function(t){this.currentObjectIdInInfoPanel=t;var e=[];var n="";var o=this.getRow(t);var i=BX.findChild(o,{tagName:"a",className:"bx-disk-folder-title"},true);var s="bx-file-icon-container-small bx-disk-file-icon";var a=BX.findChild(o,function(t){return BX.type.isElementNode(t)&&(BX.hasClass(t,"bx-disk-file-icon")||BX.hasClass(t,"bx-disk-folder-icon"))},true);if(a){s=a.className}if(!i){return}if(!o.oncontextmenu){return}var r=o.oncontextmenu();for(var c in r){if(!r.hasOwnProperty(c)){continue}var d=r[c];if(d&&d["PSEUDO_NAME"]){switch(d["PSEUDO_NAME"].toLowerCase()){case"open":if(e.length>0){e.push(BX.create("SPAN",{html:"&nbsp;"}))}e.push(BX.create("a",{attrs:{onclick:d["ONCLICK"]},text:d["TEXT"],style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-green"}}));break;case"restore":case"download":case"delete":case"destroy":if(e.length>0){e.push(BX.create("SPAN",{html:"&nbsp;"}))}e.push(BX.create("a",{attrs:{onclick:d["ONCLICK"]},text:d["TEXT"],style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"}}));break}}}this.showInfoPanel({buttons:e,isFolder:BX.hasClass(a,"bx-disk-folder-icon"),icon:{className:s},objectId:t,title:{text:i.text,date:i.getAttribute("data-bx-dateModify"),href:i.getAttribute("href")}})};t.prototype.showInfoPanel=function(t){var e=t.title||{};var n=t.icon||{};var o=t.buttons||[];var i=t.internalLink||"";var s=t.isFolder;var a=t.objectId||null;if(!e){return}var r=BX("disk_info_panel");var c=BX("bx_disk_empty_select_section");if(c)BX.hide(c);BX.cleanNode(r);this.containerWithExtAndIntLinks=null;var d=BX.create("div");r.appendChild(d);d.appendChild(BX.create("div",{props:{className:"bx-disk-info-panel"},children:[BX.create("div",{props:{className:"bx-disk-info-panel-relative"},children:[BX.create("div",{props:{className:"bx-disk-info-panel-icon"},children:[BX.create("div",{props:{className:n.className}})]}),BX.create("div",{props:{className:"bx-disk-info-panel-element-name-container"},children:[BX.create("div",{props:{id:"disk_info_panel_name",className:"bx-disk-info-panel-name"},children:[BX.create("a",{text:e.text,props:{title:e.text,href:e.href||"javascript:void(0);"}})]}),BX.create("div",{text:e.date,props:{className:"bx-disk-info-panel-date"}})]}),BX.create("div",{props:{className:"bx-disk-info-panel-context"}})]}),BX.create("div",{props:{className:"tal"},children:o})]}));new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:100,height:d.offsetHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){r.style.height=t.height+"px";r.style.opacity=t.opacity/100},complete:BX.delegate(function(){r.style.cssText=""},this)}).animate()};t.prototype.onSelectRow=function(t,e,n){this.addCheckbox(n);if(e==1){this.showInfoPanelSingleObject(n.value)}else{var o=this.grid.GetCheckedCheckboxes();var i=[];for(var s in o){if(!o.hasOwnProperty(s)||o[s].name!="ID[]"){continue}i.push(o[s].value)}this.showInfoPanelManyObject(i)}};t.prototype.onUnSelectRow=function(t,e,n){this.deleteCheckbox(n);if(e==0){var o=n.value;var i=BX("disk_info_panel");var s=BX.firstChild(i);new BX.easing({duration:300,start:{opacity:100,height:s.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){i.style.height=t.height+"px";i.style.opacity=t.opacity/10},complete:BX.delegate(function(){var t=BX("bx_disk_empty_select_section");if(t)BX.show(t,"block")},this)}).animate()}else{this.onSelectRow(t,e,this.getFirstSelectedCheckbox())}};return t}();
//# sourceMappingURL=script.map.js